export const forwardFuturesContractsQuiz = [
    {
        id: 'ffc-q-1',
        question:
            'Build a Treasury futures trading and analysis platform that: (1) Fetches live futures prices from CME (10yr ZN, 30yr ZB, 5yr ZF, 2yr ZT), (2) Calculates basis (cash bond price - futures price × conversion factor) for all deliverable bonds, (3) Identifies cheapest-to-deliver (CTD) using implied repo rate, (4) Monitors CTD switches (when different bond becomes CTD, major trading signal), (5) Generates hedge recommendations (optimal futures quantity to hedge bond portfolio). Requirements: Real-time conversion factor calculations, delivery basket tracking (bonds eligible for delivery change over time), implied volatility from futures options. How do you handle: delivery option value (short has timing option)? Wild card option (delivery notice after close)? Quality option (choose which bond to deliver)? Calendar spreads (Dec contract vs Mar contract)?',
        sampleAnswer:
            'Treasury futures platform architecture: Live data ingestion: CME Market Data: FIX/FAST protocol or CME DataMine API, Contracts: ZT (2yr), ZF (5yr), ZN (10yr), ZB (30yr), Data: Last trade, bid, ask, volume, open interest, settlement price, Update frequency: Real-time tick-by-tick or 1-second snapshots, Schema: futures_prices (timestamp, contract, month, price, volume, open_interest), Deliverable bonds: Treasury announces eligible bonds (updated quarterly), Fetch: Treasury Direct API for bond details, Criteria: For 10yr futures: bonds with 6.5-10 year remaining maturity at delivery, Store: delivery_basket (contract, month, cusip, coupon, maturity, eligible_from, eligible_to), Conversion factor calculation: Formula: CF = price of bond if yielding 6% (standard), Implementation: coupon_pmt = coupon / frequency, periods = years_to_maturity × frequency, y = 0.06 / frequency, pv_coupons = coupon_pmt × (1 - (1+y)^-periods) / y, pv_principal = 1 / (1+y)^periods, CF = pv_coupons + pv_principal, round to 4 decimals, Real-time: Recalculate as bonds approach maturity (CF changes slightly), Cache: Update once per day (CF doesn\'t change intraday), Basis calculation: Cash bond price: Fetch from TRACE or Bloomberg, Clean price: Quoted price, Dirty price: Clean + accrued interest, Futures invoice price: Invoice = Futures_price × CF / 100 × Face_value, Basis: Cash_dirty - Invoice, Gross basis: Absolute basis value, Net basis: Basis - Carry (financing cost to hold bond), Formula: Net_basis = Gross_basis - (Repo_rate × Cash_price × days/360), Interpretation: Negative net basis: Cash bond cheap vs futures (buy cash, short futures), Positive net basis: Cash bond rich (short cash, buy futures), CTD identification: Implied repo rate: For each deliverable bond: Forward_price = Futures × CF, Cost = Cash_price + Accrued, Carry = Coupon_income - Financing_cost, Implied_repo = (Forward - Cost + Carry) / Cost × (360/days), Highest implied repo = CTD, Example: Bond A: repo 3.2%, Bond B: repo 3.8% → Bond B is CTD, CTD properties: Typically lowest duration bond when yields < 6% (bull market), Highest duration bond when yields > 6% (bear market), Track: Store historical CTD for each contract month, CTD switch detection: Monitor: Daily check which bond has highest implied repo, Switch event: When CTD changes from Bond A to Bond B: Alert: "CTD switch: 912828YK0 → 912828YM6", Implication: Futures behavior changes (now tracks Bond B duration), hedge ratios must be recalculated, Trading signal: CTD switches often occur at yield inflection points (directional signal), Volatility spikes: Basis widens during switches (uncertainty about which bond delivered), Historical: Analyze past switches and subsequent price moves, Hedge ratio calculation: Duration-based: Hedge_ratio = (Portfolio_value × Portfolio_duration) / (Futures_price × CTD_duration × Contract_size) × (1/CF_ctd), DV01-based (more precise): Hedge_ratio = Portfolio_DV01 / Futures_DV01, Portfolio_DV01: Sum of individual bond DV01s, Futures_DV01: CTD_bond_DV01 / CF_ctd, Regression-based: Regress portfolio returns on futures returns: β = cov(Portfolio, Futures) / var(Futures), Hedge_ratio = β × Portfolio_value / Futures_value, accounts for imperfect correlation, Optimal: Minimize variance: min E[(ΔPortfolio - HR × ΔFutures)²], Delivery options: Timing option: Short can deliver anytime during delivery month (usually last 7 business days), Value: Wait for favorable price movement before delivering, Estimate: 2-5bp of futures price (option value), Model: American option on best delivery time, Wild card option: After futures close (2pm CT), short can still declare delivery until 8pm, If cash market moves 2pm-8pm, short benefits, Value: 1-3bp typically, Estimate: Historical volatility of 2pm-8pm price changes, Quality option: Short chooses which bond to deliver (CTD), If CTD switches during month, short delivers most favorable, Value: Embedded in basis (CTD calculation), estimate with switch probability, Total delivery option value: Futures_theoretical = Forward_price - Delivery_options_value, Typical: 5-15bp total option value, Calendar spreads: Definition: Long one contract month, short another (e.g., long Mar, short Jun), Basis: Calendar_spread = Near_contract - Far_contract, Drivers: Carry (financing cost difference), CTD changes (different CTD for each contract), Supply (Treasury issuance affects different maturities), Trading: Spread widening: Near contract outperforms (sell spread), Spread tightening: Far contract outperforms (buy spread), Typical: ±10-30bp range, breaks at extremes (50bp = mean reversion opportunity), Implied repo spread: Repo_near vs Repo_far indicates relative value, API design: GET /futures/prices?contract=ZN returns real-time futures prices, GET /futures/basis?contract=ZN&month=202406 returns basis for all deliverable bonds, GET /futures/ctd?contract=ZN&month=202406 returns CTD bond and implied repo, POST /futures/hedge with {portfolio} returns optimal hedge ratio and contracts, WebSocket /ws/futures-data for streaming prices and CTD changes, GET /futures/calendar-spread?contracts=ZN_202406,ZN_202409 returns spread analysis.',
        keyPoints: [
            'Live data: CME ZT/ZF/ZN/ZB prices, fetch deliverable bonds (6.5-10yr maturity for 10yr futures), conversion factor CF = price if yielding 6% (recalc daily)',
            'Basis: Cash_dirty - (Futures × CF / 100 × Face), net basis = gross - carry (repo cost), negative = cash cheap vs futures (arb opportunity)',
            'CTD: Highest implied_repo = (Forward - Cost + Carry) / Cost × 360/days, CTD switch = trading signal (hedge ratios change), track historical switches',
            'Hedge ratio: Duration-based (Port_val × dur) / (Fut × CTD_dur × size × 1/CF), or DV01-based (Port_DV01 / Fut_DV01), or regression β, optimize to minimize variance',
            'Delivery options: Timing (deliver anytime during month, 2-5bp value), Wild card (declare after close until 8pm, 1-3bp), Quality (choose bond, embedded in CTD), total 5-15bp',
        ],
    },
    {
        id: 'ffc-q-2',
        question:
            'Design a basis trading strategy system that: (1) Identifies cash-futures arbitrage opportunities (basis too wide/tight), (2) Executes basis trades (buy cash bond + short futures, or vice versa), (3) Manages carry (financing costs, coupon income), (4) Monitors convergence (basis → 0 at expiration), (5) Handles delivery process (if held to expiration, deliver bond into futures). Include: transaction costs (bid-ask spreads, commissions, repo costs), margin management (futures require margin, cash bonds can be rehypothecated), risk controls (stop-loss if basis moves against). How do you handle: repo rate fluctuations (financing cost changes)? CTD switches (you hold wrong bond if CTD changes)? Squeeze (shortage of deliverable bonds drives basis)? Rolling positions (close before expiry, enter next contract)?',
        sampleAnswer:
            'Basis trading system architecture: Opportunity identification: Calculate fair basis: Theoretical_basis = Carry_cost - Expected_convergence, Carry_cost = (Repo_rate - Coupon_yield) × Cash_price × days/360, Expected convergence = (Current_basis / days_to_expiry) × days, Market basis: Observed = Cash_price - (Futures × CF), Z-score: z = (Market_basis - Historical_avg) / Historical_std, Threshold: if |z| > 2 (basis 2 std devs from normal): Trade opportunity, Direction: Positive Z (basis too wide): Buy basis (long cash, short futures), Negative Z (basis too tight): Sell basis (short cash, long futures), Trade execution: Buy basis strategy: Cash leg: Buy bond in cash market (pay offer price), size: $10M face value, cost: Price × 10M + Accrued + Commission (~$10,500 total), Futures leg: Short futures: contracts = $10M / $100K × (1/CF) ≈ 105 contracts, margin: Post initial margin (~$4K per contract = $420K total), Simultaneous: Execute both legs at same time (reduce slippage), Financing: Repo agreement: Borrow cash to buy bond, post bond as collateral, Repo rate: 5.2% (term repo for duration of trade), Daily interest: $10M × 5.2% / 360 = $1,444/day, Income: Bond coupon: 4.0% × $10M / 360 = $1,111/day, Net carry: -$333/day (negative carry = paying to hold position), Carry management: Track daily: Cumulative_carry = Σ(Coupon_income - Repo_cost - Futures_settlement), P&L attribution: Basis_change: (Current_basis - Entry_basis) × Position_size, Carry: Negative or positive accumulated, Total P&L: Basis_change + Carry, Threshold: If carry > expected basis convergence profit: Exit early (carry erodes profit), Convergence monitoring: Daily basis: Plot over time, expect linear convergence to zero, Deviation: If basis widens (losing money): Check for structural reasons (CTD switch, supply shock), Stop-loss: Exit if basis widens >20bp beyond entry, Expected: Basis converges smoothly, profit from mean reversion + convergence, Target exit: 7-10 days before expiry (avoid delivery complications), Delivery management: Intention to deliver: If hold to expiry and short futures: must deliver bond, Delivery notice: Submit to exchange 2 days before delivery, Invoice: Receive Futures_settlement × CF + Accrued, Close out: Sell cash bond in market (if don\'t want to deliver), simultaneously buy back futures, Optimal: Deliver if you hold CTD bond (maximize proceeds), Otherwise: Close before delivery month (avoid non-CTD penalty), Transaction costs: Cash bond: Bid-ask spread: 2-5bp for on-the-run, 5-10bp for off-the-run, Commission: $25-100 per $1M (institutional), On $10M: ~$250-1000 total, Futures: Commission: $2-5 per contract, 105 contracts × $3 = $315, Bid-ask: 1 tick = $15.625, cross spread = $16 × 105 = $1,680, Repo: Bid-ask on repo rate: 5-10bp, affects daily carry, Total costs: ~$2,000-$3,000 roundtrip, must recover through basis convergence, Breakeven: Need basis to converge by at least 2-3bp to cover costs, Margin management: Futures margin: Initial: $4K × 105 = $420K posted, Maintenance: ~$3K per contract = $315K, Variation margin: Daily mark-to-market, gains/losses settled, If futures rise (short position loses): Must post additional margin, Margin call: If balance < maintenance, add funds immediately, Cash bond financing: Rehypothecation: Pledge bond as collateral for repo, Lender holds bond, returns at repo maturity, Haircut: Typically 2-5% (lender lends 95-98% of bond value), Risk: If bond value falls, must post additional collateral (margin call on repo), Risk controls: Stop-loss: Basis widens >20bp from entry → exit (loss ~$200K on $10M), Position limit: Max $100M basis exposure per strategy, Diversification: Trade multiple contracts/bonds (reduce idiosyncratic risk), Stress test: Model P&L if repo spikes +200bp, basis widens +50bp, CTD switches, Repo rate risk: Fluctuations: Repo rate can spike (quarter-end, year-end, Fed operations), Impact: Higher repo = higher negative carry (reduces profit), Hedge: Lock in term repo (fixed rate for trade duration), Monitor: Fed repo operations (SOMA, RRP affect repo rates), Quarter-end: Expect 20-50bp spike, factor into carry estimate, CTD switches: Risk: Hold Bond A, CTD switches to Bond B: Futures now track Bond B, your hedge less effective, Basis for Bond A may widen (no longer CTD), Detection: Daily check implied repo for all bonds, if nearing switch: Pre-emptively switch bonds: sell Bond A, buy Bond B, update futures hedge ratio, Mitigation: Trade CTD bond only (most liquid, least switch risk), or trade basket of bonds (diversify), Squeeze risk: Definition: Shortage of deliverable bonds (high demand to deliver into futures), Impact: Basis goes very negative (cash bond expensive), impossible to source bonds (repo fails), Historical: 2008 on-the-run 10yr squeeze (basis -80bp, normal ~0), Warning signs: Repo specials (bond repos <0%, scarcity premium), Fails (settlement fails increase), Open interest > deliverable supply, Mitigation: Avoid trading during known squeezes, exit early if squeeze developing, Rolling positions: Strategy: Close position before expiry, enter next contract month, Timing: 7-10 days before First Notice Day (avoid delivery risk), Execution: Day 1: Cover short futures (June), sell cash bond, Day 1: Short futures (September), buy cash bond, Costs: Roundtrip transaction costs (~$2K), but avoid delivery hassle, Basis: Monitor calendar spread (June basis vs September basis), if large divergence: Roll opportunistically, API design: GET /basis/opportunities returns trades with |z-score| > 2, POST /basis/execute with {direction, bond, quantity} executes basis trade, GET /basis/positions returns open positions with P&L attribution (basis change, carry), POST /basis/close closes position at market prices.',
        keyPoints: [
            'Opportunity: z-score = (Market_basis - Avg) / Std, if |z| > 2 trade (wide = buy basis long cash+short fut, tight = sell basis), account for carry (repo - coupon)',
            'Execution: Cash leg (buy $10M bond + accrued + commission), futures leg (short contracts = 10M/100K × 1/CF ≈105), simultaneous to reduce slippage, repo finance (5.2% rate)',
            'Carry: Daily = Coupon_income - Repo_cost - Fut_settlement, negative carry typical (pay to hold), must recover via basis convergence, exit if carry > expected profit',
            'Transaction costs: Cash spread 2-10bp + commission $250-1K, futures commission $315 + spread $1.7K, repo spread 5-10bp, total ~$2-3K roundtrip, need ≥3bp convergence',
            'Risks: Stop-loss if basis widens >20bp, CTD switch (hedge breaks, trade CTD only), squeeze (basis -80bp, repo special <0%, exit early), roll 7-10d before delivery',
        ],
    },
    {
        id: 'ffc-q-3',
        question:
            'Implement a forward rate agreement (FRA) pricing and hedging system that: (1) Prices FRAs using forward rates from zero curve, (2) Marks-to-market FRA positions daily (unrealized P&L), (3) Hedges FRA book with Eurodollar futures or SOFR futures, (4) Calculates settlement payoff at FRA maturity, (5) Manages basis risk (FRA vs futures rates may diverge). Include: day count conventions (Actual/360 vs Actual/365), compounding (simple vs compound), notional amount calculations. How do you handle: convexity adjustment (futures vs FRAs have different convexity)? LIBOR transition (legacy FRAs vs SOFR-based)? Credit risk (FRAs are OTC, counterparty risk)? Strip of FRAs (multiple sequential FRAs = synthetic swap)?',
        sampleAnswer:
            'FRA pricing and hedging system: FRA basics: Definition: Agreement on future interest rate for specified period, Notation: 3×6 FRA = 3-month rate, starting in 3 months, duration 3 months, Contract: Party A pays fixed (FRA rate), receives floating (SOFR), Party B opposite, Settlement: Net cash payment at start of interest period (not maturity), Pricing from zero curve: Forward rate calculation: Zero curve: r(t) = zero rate for maturity t, Forward rate: f(t1, t2) = [(1+r2)^t2 / (1+r1)^t1]^(1/(t2-t1)) - 1, Example: 3-month zero rate = 5.0%, 6-month zero rate = 5.2%, FRA_rate (3×6) = [(1.052)^0.5 / (1.050)^0.25]^(1/0.25) - 1 = 5.4% approx, More precise: Use continuous compounding, f = (r2×t2 - r1×t1) / (t2-t1), Implementation: Fetch zero curve from Treasury/swap curve, Interpolate for exact maturities (cubic spline), Calculate forward rate for each FRA, Mark-to-market: Initial value: FRA_value = 0 at inception (fair rate agreed), Subsequent valuation: Current_forward_rate from updated zero curve, MTM = Notional × (Current_forward - Contract_FRA) × Period × DF, DF = discount factor to settlement date, Example: FRA: 5.4% on $10M, 3×6 (3-month period), Current forward: 5.6%, Gain to receive-floating side: $10M × (5.6% - 5.4%) × 0.25 = $5,000, Discounted: PV = $5,000 × DF(3mo) = $5,000 × 0.987 = $4,935, Daily: Update as forward rates change, Settlement calculation: At start of interest period (3 months): Reference_rate = SOFR fixing on settlement date, Settlement = Notional × (Reference_rate - FRA_rate) × Period / (1 + Reference_rate × Period), Example: SOFR = 5.5%, FRA_rate = 5.4%, $10M notional, 3-month, Settlement = $10M × (5.5% - 5.4%) × 0.25 / (1 + 5.5%×0.25) = $2,466, Discounting: Division by (1 + Ref_rate × Period) because paid at start, not end of period, Hedging with futures: Eurodollar futures (legacy) or SOFR futures: Contract: $1M notional per contract, 3-month maturity, Price: 100 - implied rate (e.g., 94.50 = 5.50% rate), Hedge ratio: Notional_FRA / Notional_futures × Duration_adjustment, Example: $10M FRA / $1M futures × 1.0 = 10 contracts, Direction: Receive-floating FRA (long rates): short futures, Pay-floating FRA (short rates): long futures, Rebalancing: Adjust as FRA duration rolls down, convexity changes, Convexity adjustment: Futures vs FRAs: Futures: Daily mark-to-market, gains reinvested at new rates (convexity benefit), FRAs: Single settlement, no interim cash flows, Adjustment: Futures_rate = FRA_rate + Convexity_adjustment, Convexity_adj ≈ 0.5 × σ² × t1 × t2, where σ = rate volatility, t1 = time to start, t2 = time to maturity, Example: σ = 1% (100bp vol), t1 = 3yr, t2 = 3.25yr, Conv_adj = 0.5 × 0.01² × 3 × 3.25 = 0.0005 = 5bp, Futures trade 5bp higher than FRA (all else equal), Hedging: Account for adjustment when translating FRA to futures hedge, Day count conventions: Actual/360: Most common for FRAs (SOFR, LIBOR-based), Days = actual days in period, denominator = 360, Period_fraction = Days / 360, Actual/365: Some markets (GBP), denominator = 365, 30/360: Bonds (not FRAs), Implementation: Store convention per currency, calculate day count precisely (avoid rounding errors), LIBOR transition: Legacy FRAs: Based on LIBOR (discontinued 2023), SOFR-based FRAs: New standard, Term SOFR: CME publishes term rates (1mo, 3mo, 6mo, 12mo SOFR), replaces LIBOR in FRAs, Fallback: Legacy contracts converted: LIBOR → SOFR + Spread adjustment (26bp for 3mo), Update system: Support both LIBOR (old contracts) and SOFR (new), Migration: Novate legacy FRAs to SOFR-based, Credit risk (OTC): Counterparty exposure: MTM value = exposure if counterparty defaults, Bilateral: Both parties have exposure (depending on MTM sign), Mitigation: Credit Support Annex (CSA): Daily collateral posting, Initial margin + variation margin (similar to futures), Netting: Offset MTM across multiple FRAs with same counterparty, Clearing: Central clearing for standardized FRAs (reduces counterparty risk), CVA: Credit Value Adjustment, CVA = PD × LGD × Expected_exposure, deduct from FRA value, Strip of FRAs: Definition: Series of sequential FRAs replicating interest rate swap, Example: 3×6, 6×9, 9×12, 12×15 FRAs = 15-month synthetic swap, Pricing: Each FRA priced independently from forward curve, sum all values = swap value, Hedging: Hedge entire strip with swap or futures strip, Use: Build custom swap maturities (non-standard), arbitrage swap vs FRA markets, API design: POST /fra/price with {start, end, notional, direction} returns FRA_rate and value, GET /fra/mtm?position_id=XXX returns current mark-to-market value, POST /fra/hedge with {fra_positions} returns optimal futures hedge (contracts, direction, convexity adj), GET /fra/settlement with {position_id, reference_rate} calculates settlement payment.',
        keyPoints: [
            'Pricing: Forward_rate f(t1,t2) = (r2×t2 - r1×t1)/(t2-t1) from zero curve, FRA_value = Notional × (Current_fwd - Contract_rate) × Period × DF, mark-to-market daily',
            'Settlement: At start of period, pmt = Notional × (Ref_rate - FRA_rate) × Period / (1 + Ref_rate × Period), discounted because paid at start not end',
            'Hedging: Eurodollar or SOFR futures, hedge_ratio = Notional_FRA / Notional_fut × duration_adj, receive-float = short futures, pay-float = long futures',
            'Convexity adjustment: Futures rate = FRA rate + Conv_adj, Conv_adj ≈ 0.5×σ²×t1×t2 (futures higher due to daily settlement reinvestment), 5bp typical for 3yr',
            'LIBOR transition: Legacy FRAs (LIBOR-based) → SOFR + spread adj (26bp for 3mo), Term SOFR (CME publishes 1/3/6/12mo rates), CSA collateral for credit risk',
        ],
    },
];

