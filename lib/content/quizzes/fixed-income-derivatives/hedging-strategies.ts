export const hedgingStrategiesQuiz = [
  {
    id: 'hs-q-1',
    question:
      "Build a dynamic delta hedging system that: (1) Monitors portfolio Greeks in real-time (aggregate delta, gamma, vega, theta), (2) Auto-rebalances when delta exceeds threshold (±10 shares equivalent), (3) Optimizes hedging instruments (futures vs stocks vs options), (4) Tracks hedging P&L separately from option P&L, (5) Minimizes transaction costs while maintaining delta-neutrality. Include: rebalancing frequency optimization (daily, intraday, or triggered), gamma scalping P&L attribution, slippage modeling. How do you handle: pin risk (stock near strike at expiry)? Overnight gaps (market closed, can't rebalance)? Multiple underlyings (basket options)? Greeks changing as expiry approaches?",
    sampleAnswer:
      "Dynamic delta hedging system: Real-time Greeks monitoring: Calculate portfolio Greeks: For each option position i: Delta_i = ∂V_i/∂S using Black-Scholes or numerical methods, Gamma_i = ∂²V_i/∂S², Vega_i = ∂V_i/∂σ, Theta_i = ∂V_i/∂t, Aggregate: Total_delta = Σ(Delta_i × quantity_i), similarly for gamma/vega/theta, Update frequency: Continuous (every tick) for active trading, or Every minute for moderate activity, WebSocket feeds from exchanges for real-time data, Delta threshold rebalancing: Threshold: ±10 shares equivalent (configurable), Monitor: If |Total_delta| > 10: Trigger rebalance, Calculate required hedge: Shares_to_trade = -Total_delta (neutralize), Execute: Market order (fast) or limit order (better price, slower), Post-trade: Verify new delta ≈ 0 (within ±2 shares), Optimization: Minimize transaction costs: Cost = |shares| × spread/2 + commission, Balance: Tighter delta (more rebalancing, higher costs) vs looser delta (less rebalancing, more risk), Optimal threshold: Backtest various thresholds (5, 10, 20 shares), choose lowest total cost (rebalancing + risk), Hedging instrument selection: Futures vs Stocks vs Options: Futures: Pros: Leverage (lower capital), no borrow cost, Cons: Basis risk, contract size constraints, Use when: Large position (1000+ shares equivalent), Stocks: Pros: Exact hedge (no basis risk), liquid, Cons: Capital intensive, borrow costs for shorts, Use when: Moderate size (100-1000 shares), Options: Pros: Can hedge gamma (convexity), cheaper for OTM hedges, Cons: Complex (own Greeks), theta decay, Use when: Want to hedge gamma not just delta, or hedging tail risk, Selection algorithm: If |delta| > 1000: Use futures (efficient for size), Else if |delta| > 100: Use stocks (precise), Else if want gamma hedge: Use options (straddle), Optimization: Linear programming, Variables: x_futures, x_stocks, x_options, Constraints: Delta_futures×x_futures + Delta_stocks×x_stocks + Delta_options×x_options ≈ -Portfolio_delta, Minimize: Cost_futures×x_futures + Cost_stocks×x_stocks + Cost_options×x_options, P&L tracking: Separate hedge P&L from option P&L: Option P&L: Value change of option positions (market risk), Hedge P&L: Gain/loss from stock/futures trades (hedging activity), Total P&L: Option_PnL + Hedge_PnL (net portfolio), Gamma scalping P&L: When stock rises: Delta increases (long options have positive gamma), Rebalance: Sell shares at high price, P&L: Sell_price - Avg_cost > 0 (profit), When stock falls: Delta decreases, Rebalance: Buy shares at low price, P&L: Avg_cost - Buy_price > 0 (profit), Cumulative: Gamma_scalping_PnL = Σ(rebalancing profits) - Θ×days (theta decay cost), Breakeven: Need realized_volatility > implied_volatility paid for options, Transaction cost modeling: Spread: Bid-ask spread = (ask - bid) / midpoint, typically 0.01-0.10% for liquid stocks, Slippage: Market impact = β × (shares / ADV)^γ, where ADV = average daily volume, typical: γ = 0.5-0.7 (square root impact), Commission: $0.50-$1.00 per contract (options), $0.005-$0.01 per share (stocks), Total cost per rebalance: Cost = shares × (spread/2 + slippage) + commission, Optimize: Reduce rebalancing frequency if costs too high, Pin risk at expiry: Definition: Stock trades near strike at expiration, Risk: Delta flips from 0.5 to 0 or 1 suddenly (huge gamma), If stock $100, calls ATM: Friday close: $99.90 (slightly OTM, delta ≈ 0.20), Expiry: If stock $100.10 (slightly ITM, delta = 1.00), Delta swing: 0.80 increase = 80 shares per contract, impossible to hedge last minute, Management: Close or roll positions 1 week before expiry (avoid pin risk entirely), Or: Accept risk (often delta oscillates around 0.5, net impact small over time), Overnight gaps: Market closed 5pm-9:30am ET (16.5 hours), Gap risk: Stock moves significantly overnight (earnings, news), can't rebalance, Example: Close: Delta = 0, overnight gap +5%, Open: Delta = +50 (significant exposure), Mitigation: Hedge before close if expecting volatility (earnings after hours), Use options: Long straddle hedges gamma (protects against gaps), Limit size: Reduce positions before high-risk events, Monitor: After-hours trading (4pm-8pm), can sometimes rebalance, Multiple underlyings: Basket options or portfolio: Delta_total = Σ(Delta_i × Spot_i) across all underlyings, Correlation: Important, ρ affects total portfolio risk, Hedge each separately: Stock A: Short Delta_A shares of A, Stock B: Short Delta_B shares of B, Or use index: If portfolio ≈ S&P500, short SPY futures (cheaper, single instrument), Basis risk: Portfolio tracking error vs index, idiosyncratic risk remains, Greeks evolution near expiry: Gamma explosion: Days to expiry ↓ → Gamma ↑ (ATM options), T=30 days: Gamma = 0.05, T=7 days: Gamma = 0.15 (3×), T=1 day: Gamma = 0.50 (10×), Impact: More frequent rebalancing needed (delta changes faster), Theta acceleration: T=30 days: θ = -$5/day, T=7 days: θ = -$15/day, T=1 day: θ = -$50/day, Gamma scalping: Must generate P&L to offset theta (realized vol > implied), Vega decline: T=30 days: Vega = $100 per 1% vol, T=7 days: Vega = $40, T=1 day: Vega = $10, Less sensitive to vol changes near expiry, API design: GET /hedge/portfolio-greeks returns {delta, gamma, vega, theta, positions}, POST /hedge/rebalance with {target_delta} executes optimal hedge trades, GET /hedge/pnl returns {option_pnl, hedge_pnl, gamma_scalping_pnl, total}, WebSocket /ws/greeks-realtime streams live portfolio Greeks (every tick).",
    keyPoints: [
      'Real-time Greeks: Calculate Σ(Delta_i × qty_i) for all positions, update continuously or per minute, trigger rebalance when |delta| > threshold (±10 shares)',
      'Instrument selection: Futures (>1000 delta, leverage), Stocks (100-1000, precise), Options (hedge gamma), optimize via linear programming to minimize costs',
      'P&L tracking: Option PnL (market risk), Hedge PnL (rebalancing activity), Gamma scalping = Σ(rebalance profits) - Θ×days, breakeven when realized vol > implied',
      'Transaction costs: Spread (0.01-0.10%), slippage (β×(shares/ADV)^γ), commission ($0.01/share), total cost affects optimal rebalancing frequency',
      "Pin risk: Stock near strike at expiry (delta flips 0.5→0 or 1), close 1 week before expiry, overnight gaps (16.5hrs, can't rebalance), hedge before high-risk events",
    ],
  },
  {
    id: 'hs-q-2',
    question:
      'Design a portfolio immunization system for fixed income that: (1) Matches portfolio duration to liabilities (pension fund example), (2) Optimizes bond selection to achieve target duration within budget, (3) Rebalances as durations drift (bonds age, rates change), (4) Minimizes convexity mismatch (duration matching not enough for large moves), (5) Handles multiple liabilities (cash flow matching vs duration matching). Include: key rate durations (match by maturity bucket), optimization constraints (min/max per issuer, rating limits). How do you handle: non-parallel shifts (curve steepening/flattening)? Callable bonds (negative convexity)? Reinvestment risk? Funding ratio monitoring (assets/liabilities)?',
    sampleAnswer:
      'Portfolio immunization system: Duration matching fundamentals: Liability: $100M payment due in 7 years, PV at 5% = $71.07M (discount factor), Duration of liability = 7 years (single payment), Portfolio requirement: Duration = 7 years, Value = $71.07M (funded 100%), Bond selection optimization: Objective: Minimize cost or maximize yield, Variables: x_i = amount invested in bond i, Constraints: Σ(x_i × Duration_i) / Σ(x_i) = 7 years (target duration), Σ(x_i) = $71.07M (total value), x_i ≥ 0 (no shorts), Diversification: 0 ≤ x_i ≤ $10M per issuer (limit concentration), Rating: At least 70% investment grade, Optimization: Linear or quadratic programming, Solver: CVXPY, scipy.optimize, or commercial (Gurobi), Output: Optimal bond weights {x_1, x_2, ..., x_n}, Example solution: 30% 5-year Treasury (duration 4.5), 50% 7-year Corporate (duration 6.2), 20% 10-year Treasury (duration 8.5), Weighted duration: 0.30×4.5 + 0.50×6.2 + 0.20×8.5 = 6.65 years ≈ 7 (close enough), Duration drift rebalancing: Passage of time: 7-year bond becomes 6.5-year bond after 6 months (duration decreases), Rate changes: If rates rise, duration decreases (price-weighted), If rates fall, duration increases, Monitor daily: Current_duration = Σ(Bond_value_i × Duration_i) / Portfolio_value, Rebalance trigger: If |Current_duration - Target_duration| > 0.5 years: Rebalance, Sell bonds with too-short duration, Buy bonds with longer duration to restore match, Example: Duration drifted to 6.3 years (target 7), need to increase by 0.7 years, Sell 5-year bonds, buy 10-year bonds (shift duration out), Convexity matching: Why duration not enough: Duration = first-order (linear) approximation, Large rate moves: Price change ≠ -Duration × Δy (error from convexity), Convexity: Second-order term, ΔP/P ≈ -D×Δy + 0.5×C×(Δy)², Positive convexity (bonds): Good, upside > downside, Negative convexity (callables): Bad, upside capped, Matching: Target: Portfolio convexity ≈ Liability convexity, Single liability: Convexity = Duration² (high), Portfolio: Select bonds with higher convexity (longer maturities better), Constraint: Add to optimization: Σ(x_i × Convexity_i) / Σ(x_i) ≥ Target_convexity, Trade-off: Higher convexity bonds may have lower yield (pay for optionality), Key rate durations: Problem: Non-parallel shifts (2yr rate moves differently from 10yr), Key rate durations (KRD): Sensitivity to each maturity point (2yr, 5yr, 10yr, 30yr separately), Matching: For each bucket: Portfolio_KRD_k ≈ Liability_KRD_k, Example liability: $50M in 5 years + $50M in 10 years, Match: Portfolio_KRD_5yr = large (from 5-year bonds), Portfolio_KRD_10yr = large (from 10-year bonds), Optimization: Multi-constraint: Σ(x_i × KRD_i,k) ≈ Liability_KRD_k for each k, More complex (more constraints), better hedge for non-parallel shifts, Cash flow matching vs duration matching: Cash flow matching: Buy bonds with cash flows exactly matching liabilities, Example: Liability $10M in yr 5, $15M in yr 7, $20M in yr 10, Buy: $10M 5-year bond, $15M 7-year bond, $20M 10-year bond, Perfect match: No rebalancing needed, Advantage: No interest rate risk (exact match), Disadvantage: Less flexible, may be expensive (fewer bonds to choose from), Duration matching: Match duration not exact cash flows, Advantage: More flexible, optimize yield, Disadvantage: Rebalancing needed, residual rate risk, Choice: Cash flow matching for critical liabilities (pension payments), Duration matching for general ALM, Multiple liabilities: Liability schedule: Year 1: $5M, Year 3: $10M, Year 5: $15M, Year 7: $20M, Aggregate approach: Calculate aggregate duration: Weighted avg of liability durations, Match: Portfolio duration = Aggregate liability duration, Simpler but imperfect, Dedicated portfolio: Separate portfolio for each liability, More precise but complex, Optimization: Multi-period matching: Constraints for each liability date, ensures coverage of all payments, Non-parallel shifts: Scenario analysis: Parallel shift: +100bp all maturities, Steepening: Short +200bp, long +50bp, Flattening: Short +50bp, long +200bp, Twist: Mid-rates up, ends down, Stress test portfolio: Measure funding ratio under each scenario, Target: Funding ratio > 95% in all scenarios (robust), Hedge: If vulnerable to steepening, adjust KRD (shorten short-end, lengthen long-end), Callable bonds: Negative convexity problem: When rates fall, bonds called (upside capped), Duration shortens unexpectedly (from 7yr to 2yr if call likely), Breaks immunization: Portfolio duration now too short, liability unhedged, Mitigation: Avoid callables in immunization portfolio (use non-callable Treasuries/agencies), Or: Model effective duration (account for call probability), reduces measured duration, Adjust portfolio: Hold more notional to compensate, Reinvestment risk: Coupon reinvestment: Receive coupons, must reinvest at prevailing rates (uncertain), If rates fall: Reinvest at lower rates (less income), If rates rise: Reinvest at higher rates (more income), Immunization: Duration matching mitigates this, Rebalancing: As rates change, rebalance portfolio, approximately offsets reinvestment effect, Zero-coupon bonds: No reinvestment risk (single payment at maturity), Perfect immunization for single liability (match maturity to liability date), Funding ratio monitoring: Funding ratio = Portfolio_value / Liability_value, Well-funded: Ratio ≥ 1.00 (assets cover liabilities), Underfunded: Ratio < 1.00 (deficit), Daily calculation: Portfolio_value = Σ(Bond_price_i × quantity_i), Liability_value = PV(future payments at current rates), Funding_ratio = Portfolio / Liability, Target: Keep ratio ≥ 1.00 (100% funded), Alerts: If ratio < 0.95: Urgent rebalancing needed or contribute more assets, If ratio > 1.05: Surplus (can take more risk or return capital), Contributions/withdrawals: If underfunded: Contribute assets, If overfunded: Can distribute surplus or de-risk, API design: POST /immunization/optimize with {liabilities, bond_universe, constraints} returns optimal portfolio, GET /immunization/metrics with {portfolio_id} returns {duration, convexity, KRDs, funding_ratio}, POST /immunization/rebalance checks if rebalancing needed, executes trades if required, GET /immunization/stress-test with {scenarios} returns funding ratio under each scenario.',
    keyPoints: [
      'Duration matching: Σ(x_i×Dur_i)/Σ(x_i) = Target_dur, optimize bond weights with constraints (value, diversification, rating), rebalance when drift >0.5 years',
      'Convexity: Match portfolio convexity ≈ liability convexity (duration² for single payment), avoid negative convexity (callables), higher convexity = better protection large moves',
      'Key rate durations: Match each maturity bucket (2/5/10/30yr) separately, hedges non-parallel shifts (steepening/flattening), multi-constraint optimization',
      'Cash flow matching vs duration: Cash flow (exact match, no rebalancing, less flexible), Duration (flexible, optimize yield, requires rebalancing), combine for critical liabilities',
      'Funding ratio: Assets/Liabilities, monitor daily, target ≥1.00 (100% funded), alert if <0.95 (underfunded), stress test scenarios (parallel, steepening, flattening, twist)',
    ],
  },
  {
    id: 'hs-q-3',
    question:
      'Implement a macro hedging strategy system that: (1) Identifies systematic risk factors (equity beta, interest rate sensitivity, credit spread exposure, FX exposure), (2) Recommends hedging instruments (VIX options, Treasury futures, CDX indices, FX forwards), (3) Calculates optimal hedge ratios (regression-based, minimize portfolio variance), (4) Backtests hedge effectiveness (correlation during stress vs normal times), (5) Monitors hedge performance (P&L attribution, cost of hedging). Include: tail risk hedging (out-of-money puts, VIX calls), dynamic hedging (increase hedge in high vol). How do you handle: basis risk (hedge instrument ≠ portfolio exactly)? Hedge costs (drag on returns)? When to remove hedge (market stabilizes)? Crisis correlations (correlations → 1 in crashes)?',
    sampleAnswer:
      'Macro hedging system: Systematic risk factor identification: Factor exposure analysis: Equity beta: Regress portfolio returns on market returns (S&P500), β_equity = cov(Port, Mkt) / var(Mkt), Example: β = 0.80 (80% market sensitivity), Interest rate sensitivity: Regress on Treasury yield changes, β_rates = ∂Portfolio / ∂yields, Example: +100bp rates → portfolio -8% (β = -8), Credit spread exposure: Regress on CDX index spreads, β_credit = ∂Portfolio / ∂spreads, Example: +100bp spreads → portfolio -5% (β = -5), FX exposure: Regress on currency pairs (EUR/USD, JPY/USD), β_FX = Δ Portfolio / Δ FX_rate, Implementation: Rolling regression (250-day window), update weekly, multi-factor model: Portfolio_return = α + β_equity×Mkt + β_rates×ΔRates + β_credit×ΔSpreads + β_FX×ΔFX + ε, R² measures how much explained by factors (target >0.70 for good model), Hedging instrument selection: Equity risk (β_equity = 0.80): Hedge: Short SPY or S&P futures, Ratio: 0.80 × Portfolio_value / Futures_value contracts, Alternative: Buy VIX calls (tail risk protection), Interest rate risk (β_rates = -8): Hedge: Short Treasury futures (rates rise → portfolio falls → futures profit), Ratio: (Portfolio × |β_rates|) / (Futures × DV01_futures), Example: $100M × 8 / ($100K × 70 DV01) = 114 contracts, Credit spread risk (β_credit = -5): Hedge: Short CDX.IG or CDX.HY index, Ratio: (Portfolio × |β_credit|) / (CDX notional × CS01), Captures: Systematic credit risk (not idiosyncratic), FX risk (β_FX for EUR = 0.30): Hedge: EUR/USD forward contracts, Ratio: Portfolio × β_FX = $30M EUR exposure (for $100M portfolio), Enter: Sell €30M forward (lock in rate), Optimal hedge ratio calculation: Variance minimization: Objective: Minimize var(Hedged_portfolio), Hedged return: R_hedged = R_port + h × R_hedge, where h = hedge ratio (to solve), Variance: var(R_hedged) = var(R_port) + h²×var(R_hedge) + 2h×cov(R_port, R_hedge), Optimal h: ∂var/∂h = 0, solve: h* = -cov(R_port, R_hedge) / var(R_hedge), Example: cov(Port, SPY_futures) = 0.02, var(SPY_futures) = 0.03, h* = -0.02/0.03 = -0.67 (short 67% of portfolio value in futures), Regression-based: Run regression: R_port = α + β×R_hedge + ε, β = optimal hedge ratio (from regression), Adjust: For contract sizes: Contracts = (Portfolio × β) / Contract_size, Backtest hedge effectiveness: Historical simulation: Period: Use 5 years of historical data (includes 1-2 stress events), Unhedged portfolio: Calculate returns, volatility, max drawdown, Hedged portfolio: Apply hedge (short futures/buy VIX), recalculate, Metrics: Volatility reduction: σ_hedged / σ_unhedged (target <0.70, 30% reduction), Max drawdown improvement: DD_hedged vs DD_unhedged, Sharpe ratio: (Return - RF) / σ, should improve with hedge, Crisis vs normal: Correlation: Calculate ρ(Port, Hedge) in normal times vs crisis, Normal (VIX <20): ρ = -0.60 (moderate hedge), Crisis (VIX >40): ρ = -0.85 (strong hedge), Hedge effectiveness: Better in crisis (when needed most) = good hedge design, Cost-benefit: Calculate net return after hedging costs, ensure positive risk-adjusted benefit, Tail risk hedging: Out-of-money puts: Strike: 10-20% below current (SPY $450 → buy $400 puts), Cheap: Cost 1-2% annually, massive payoff if crash, Payoff: If market -30%: Puts gain 5-10× (large asymmetry), Example: $100M portfolio, $1M put cost, crash: portfolio -$30M, puts +$5M, net -$25M (better than -$30M), VIX calls: Strike: VIX 30 or 40 (current VIX 15), Cheap: $100K-$500K for $100M portfolio, Crisis: VIX spikes to 80 (2020), calls gain 10-50×, Insurance: Pay small premium for large protection, Dynamic hedging: Volatility regime: Low vol (VIX <15): Reduce hedge (50% of target), Normal vol (VIX 15-25): Standard hedge (100%), High vol (VIX >25): Increase hedge (150% of target), Rationale: Low vol: Hedging costs high relative to risk, reduce, High vol: Risk elevated, need more protection, Implementation: If VIX crosses 25: Increase hedge by 50% (buy more protection), If VIX falls below 15: Reduce hedge by 50% (lower costs), Basis risk: Definition: Hedge instrument doesn\'t perfectly match portfolio, Example: Hedge Russell 2000 portfolio with S&P futures, Tracking error: Portfolio outperforms/underperforms hedge instrument, Impact: Residual risk remains (not fully hedged), Measurement: Track hedged portfolio volatility, should be much lower than unhedged, if not: basis risk too high, improve hedge (use better instrument, multiple hedges), Mitigation: Use closer hedge: Russell 2000 portfolio → IWM futures (not SPY), Basket of hedges: Combine multiple instruments (SPY + IWM + QQQ), Hedge costs: Direct costs: Option premiums: VIX calls cost 1-2% annually, Futures: No premium but margin requirements + potential rollover costs (contango), Forwards: Bid-ask spread (10-50bp), Opportunity cost: Hedged portfolio: Lower returns in bull markets (hedge loses money), Unhedged: Higher returns but higher risk, Trade-off: Accept lower average returns for downside protection, Monitoring: Cost_of_hedge = Avg(hedge_losses_in_up_markets), Target: <1.5% annual drag acceptable for 30% drawdown protection, When to remove hedge: Market stabilizes: VIX falls below 15 for 20 consecutive days (calm), Funding: Hedge costs exceeded budget (trim or remove), Rebalancing: Every quarter, re-evaluate need based on volatility and outlook, Signals: VIX < 15 and declining: Reduce hedge by 50%, VIX < 12: Remove entirely (very low risk environment), Re-enter: VIX > 20 or portfolio drawdown >5%, Crisis correlations: Correlation breakdown: Normal: Assets diversified (stocks/bonds ρ = -0.30), Crisis: Everything falls together (ρ → +0.90), "Flight to quality": Only Treasuries and gold work, Hedge design: Must work in crisis: VIX calls, Treasury longs, Gold, Avoid: Strategies relying on diversification (fails in crisis), Historical: 2008: Stocks/credit/real estate all fell, diversification failed, only Treasuries worked, 2020 March: Similar, VIX spike to 80, hedges that worked: VIX calls, TLT (long Treasury ETF), API design: POST /macro-hedge/factors with {portfolio} returns {beta_equity, beta_rates, beta_credit, beta_FX}, POST /macro-hedge/recommend returns optimal hedging instruments and ratios, POST /macro-hedge/backtest with {portfolio, hedges, period} returns effectiveness metrics, GET /macro-hedge/performance returns P&L attribution (portfolio, hedge, net), cost analysis.',
    keyPoints: [
      'Factor identification: Regress portfolio on systematic factors (equity β, rate sensitivity, credit spread β, FX β), rolling 250-day window, R²>0.70 target',
      'Optimal hedge ratio: h* = -cov(Port, Hedge)/var(Hedge) minimizes variance, regression β as hedge ratio, adjust for contract sizes, backtest 5yr history',
      'Tail risk: OTM puts (10-20% below, 1-2% annual cost), VIX calls (strike 30-40, cheap), crisis payoff 5-10× (asymmetric protection), dynamic sizing with VIX',
      'Hedge effectiveness: Vol reduction (σ_hedged/σ_unhedged target <0.70), max drawdown improvement, Sharpe ratio increase, crisis correlation (ρ better in stress = good)',
      'Costs: Options 1-2% annual, opportunity cost (underperformance in bull markets), monitor drag <1.5% acceptable, remove when VIX<15 for 20 days (market stabilizes)',
    ],
  },
];
