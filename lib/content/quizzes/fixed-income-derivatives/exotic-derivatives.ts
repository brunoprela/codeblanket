export const exoticDerivativesQuiz = [
  {
    id: 'ed-q-1',
    question:
      'Build an exotic derivatives pricing library that: (1) Prices barrier options (up-and-out, down-and-out, up-and-in, down-and-in) using Monte Carlo simulation, (2) Prices Asian options (arithmetic and geometric average), (3) Implements lookback options (max/min over period), (4) Handles path-dependent options (barrier monitoring frequency, averaging periods), (5) Calculates Greeks for exotic options (numerical methods required). Requirements: Variance reduction (antithetic variates, control variates), convergence testing, multiple underlying assets (basket options). How do you handle: barrier monitoring (continuous vs discrete)? Early exercise (American-style exotics)? Smile effects (local volatility, stochastic volatility)? Model calibration (fit to vanilla options first)?',
    sampleAnswer:
      'Exotic derivatives library: Monte Carlo framework: Path simulation: Geometric Brownian Motion: S(t+dt) = S(t) × exp((r-0.5σ²)dt + σ√dt×Z), Z ~ N(0,1), Time steps: 252 steps for 1-year option (daily monitoring), Paths: 10,000+ for convergence (100,000 for high accuracy), Vectorization: Numpy arrays (all paths simultaneously), shape (num_paths, num_steps), Barrier options: Up-and-out call: Simulate path, check if any S(t) ≥ Barrier, if barrier hit: payoff = 0, else: payoff = max(S(T) - K, 0), Monitoring: Discrete (daily checks) vs Continuous (Brownian bridge adjustment), Continuous approximation: Barrier_hit = max(path) ≥ B × exp(-0.5826 × σ × √dt) (adjustment factor), Down-and-in put: Activate only if min(path) ≤ Barrier, if activated: payoff = max(K - S(T), 0), else: 0, Pricing: Discount avg(payoffs) by exp(-rT), Asian options: Arithmetic average: Avg = (1/n) × Σ S(ti), Payoff_call = max(Avg - K, 0), More common but no closed form (Monte Carlo required), Geometric average: Avg_geom = [Π S(ti)]^(1/n), Has closed-form approximation (faster), Payoff = max(Avg_geom - K, 0), Control variate: Use geometric as control for arithmetic (correlated, reduces variance), Lookback options: Lookback call (floating strike): Payoff = S(T) - min(path), benefit from lowest price over period, Lookback put (floating strike): Payoff = max(path) - S(T), benefit from highest price, Fixed strike: Payoff_call = max(max(path) - K, 0), Expensive: Always optimal exercise (no time decay), Variance reduction: Antithetic variates: For each random Z, also simulate -Z (opposite path), Reduces variance by ~50%, paths needed halved, Implementation: Z1 = np.random.normal(size=(n_paths, n_steps)), Z2 = -Z1, simulate both, average payoffs, Control variates: Use correlated instrument with known price, Example: Geometric Asian (known) controls Arithmetic Asian (unknown), Adjustment: Price_arith ≈ Price_arith_MC + β×(Price_geom_closed - Price_geom_MC), β = covariance coefficient, Reduces variance significantly (factor of 5-10×), Moment matching: Ensure simulated paths match expected moments (mean, variance), Stratified sampling: Divide probability space, sample from each stratum, Convergence testing: Standard error: SE = σ_payoffs / √n_paths, 95% confidence: Price ± 1.96×SE, Target: SE < $0.10 for $10 option (1% accuracy), Convergence plot: Price vs number of paths, should stabilize, Rule: Continue until SE stops decreasing significantly, Basket options: Multiple underlyings: S1, S2, ..., Sn (e.g., basket of 5 stocks), Correlation matrix: ρij between each pair, Cholesky decomposition: Decompose corr matrix, generate correlated random numbers, Payoff: max(weighted_avg(S1, S2, ..., Sn) - K, 0), Example: Equal-weighted basket of 5 tech stocks, Barrier monitoring: Discrete: Check barrier only at specific times (daily close), Cheaper: Lower probability of hitting barrier (less frequent checks), Continuous: Check at every instant (theoretical), Adjustment: Apply continuity correction: Barrier_effective = Barrier × exp(±β×σ×√dt), β ≈ 0.5826, Example: Barrier $120, σ=25%, dt=1/252, effective $119.42, American-style exotics: Early exercise + path-dependence: Complex combination, Least-Squares Monte Carlo (LSM): Simulate forward, regress continuation value on state variables, Backward induction: Decide exercise vs continue at each step, Example: American Asian call, can exercise before maturity based on running average, Computational: 10× slower than European exotics, Model calibration: Smile effects: Vanilla options have implied vol smile/skew (not flat), Exotic pricing: Should match vanilla market, Local volatility: σ(S,t) varies by spot and time, calibrate to vanilla smile, Dupire formula: σ_local²(K,T) = (∂C/∂T + rK∂C/∂K) / (0.5K²∂²C/∂K²), Stochastic volatility: Heston model, vol itself follows stochastic process, dσ² = κ(θ - σ²)dt + ξσdW, Calibration: Fit model to vanilla option prices (1-month, 3-month, 6-month, 1-year), Use fitted model for exotic pricing (consistent), API design: POST /exotic/barrier with {spot, strike, barrier, type, maturity} returns price and greeks, POST /exotic/asian with {spot, strike, maturity, avg_type} returns price, POST /exotic/basket with {underlyings, weights, correlation_matrix} prices basket option, GET /exotic/convergence?paths=1000,10000,100000 returns convergence analysis.',
    keyPoints: [
      'Monte Carlo: GBM simulation S(t+dt)=S(t)×exp((r-0.5σ²)dt+σ√dt×Z), 10K+ paths, 252 steps/year, vectorize with numpy arrays (all paths simultaneously)',
      'Barrier: Up-and-out (payoff=0 if max≥B), down-and-in (activate if min≤B), discrete (daily checks) vs continuous (Brownian bridge adjustment B×exp(-0.5826σ√dt))',
      'Asian: Arithmetic avg (no closed form, MC), geometric avg (closed form, use as control variate), reduces variance 5-10×, lookback (min/max over period)',
      'Variance reduction: Antithetic variates (Z and -Z, 50% variance reduction), control variates (correlated known-price instrument), moment matching, stratified sampling',
      'Model calibration: Fit local vol σ(S,t) or Heston to vanilla smile first, use fitted model for exotics (consistency), Dupire or Heston model, LSM for American',
    ],
  },
  {
    id: 'ed-q-2',
    question:
      'Design a structured products trading and analysis platform that: (1) Decomposes structured notes into components (zero-coupon bond + derivatives), (2) Values each component separately and aggregates, (3) Calculates embedded option values (what investor pays for optionality), (4) Analyzes payoff profiles (best/worst case scenarios), (5) Compares to alternatives (buying components separately). Include: principal protected notes, reverse convertibles, autocallables, range accruals. How do you handle: issuer credit risk (structured note = unsecured debt of issuer)? Liquidity risk (no secondary market, hold to maturity)? Tax treatment (ordinary income vs capital gains)? Mark-to-market (model-based, no daily quotes)?',
    sampleAnswer:
      'Structured products platform: Product decomposition: Principal Protected Note (PPN): Structure: Invest $1,000, guaranteed return of principal + upside, Components: Zero-coupon bond: $950 (5-year zero yielding 1.0%, grows to $1,000), Call option: $50 (participation in stock upside), Maturity payoff: $1,000 + max(0, 50% × Stock_gain), Valuation: Bond: PV($1,000, 5yr, 1.0%) = $950, Option: Black-Scholes($50 notional, 5yr, stock params) = $50, Total: $950 + $50 = $1,000 (fair value), Reverse convertible: Structure: High coupon note, may convert to stock if below barrier, Components: Bond: Fixed coupon (e.g., 10% annual), Short put option: Obligation to buy stock at strike if below, Example: $1,000 note, 10% coupon, converts to stock if <$80 at maturity, Payoff: Stock ≥ $80: Receive $1,000 + coupons, Stock < $80: Receive stock worth $800 (loss $200), Valuation: Bond: PV(10% coupons + $1,000 principal) @ 3% rate = $1,294, Short put: Sell put @ $80 strike, receive $294 premium, Net: $1,294 - $294 = $1,000 (investor pays fair), Autocallable: Structure: High coupon, can be called early if stock above barrier, Components: Callable bond (issuer can redeem early), Barrier options (knock-out feature), Example: 3-year note, 8% coupon, callable annually if stock ≥ $100, Year 1: Stock $105 → called, investor receives $1,080 (principal + 1yr coupon), Year 2: If not called, pay 8% again, check barrier, Year 3: Final payment if not called earlier, Valuation: Bond: PV(8% coupons) with probability-weighted maturities, Call options: Issuer owns call (reduces note value), value = $X, Net: Bond_value - Call_value = $1,000, Range accrual: Structure: Coupon accrues only when index within range, Components: Bond + digital options (in-range pays coupon, out-range pays 0), Example: 5% coupon if SOFR between 4-6%, Components: Floating rate note at 5%, Short digital option (pays if SOFR <4%), Short digital option (pays if SOFR >6%), Valuation: FRN: PV(5% floating payments) = $1,020, Digitals: Value of options sold = $20, Net: $1,020 - $20 = $1,000, Embedded option values: Calculate separately: Total_note_value = Bond_component + Option_components, Embedded_option_value = Note_value - Plain_bond_value, Example: PPN: Total $1,000, Plain bond $950, Embedded call $50, Investor pays $50 for optionality (5% of investment), Compare: Buy plain bond + option separately, if cheaper → note overpriced, Payoff analysis: Scenario generation: Best case: Stock +50%, Worst case: Stock -50%, Base case: Stock flat, Expected: Probability-weighted average, Calculate: Payoff = f(Stock_price_T) for each scenario, NPV: Discount payoffs to present, IRR: Internal rate of return over holding period, Comparison to alternatives: Alternative 1: Buy stock directly: Payoff: Full upside + downside, Cost: $1,000, Expected return: E[Stock_return], Alternative 2: Buy zero-coupon + call: Components: Zero $950 + Call $50 = $1,000, Payoff: Same as PPN, but may be cheaper (no structuring fee), Alternative 3: Hold cash: Payoff: $1,000 (risk-free), Opportunity cost: Miss upside, Comparison: Calculate risk-adjusted return (Sharpe ratio) for each, recommend best option, Issuer credit risk: Structured note = unsecured debt: If issuer defaults, note worthless (lose principal + optionality), Example: Lehman Brothers 2008, structured notes went to $0.08 on dollar, Credit exposure: Full notional at risk (not just option value), Mitigation: Buy only from strong issuers (AA+ or better), Diversify: Spread across multiple issuers, Hedge: Buy CDS protection on issuer, Pricing adjustment: Deduct issuer CVA: Note_value = Components_value - CVA, CVA = PD_issuer × LGD × Exposure, Liquidity risk: No secondary market: Structured notes illiquid (hold to maturity typically), Early exit: Must sell back to issuer (wide bid-ask, 5-10%), Pricing: Issuer marks internally (no independent quotes), Risk: Cannot exit if circumstances change, locked in, Compensation: Higher coupon compensates for illiquidity (1-2% premium), Tax treatment: Coupon income: Ordinary income (taxed at marginal rate, up to 37%), Option gains: May be ordinary income (depends on structure), Capital gains: Not typically eligible (coupon payments = ordinary), Phantom income: Some structures (OID = original issue discount), taxed annually even if no cash received, Optimization: Hold in tax-deferred accounts (IRA, 401k) to avoid annual tax, Mark-to-market: No daily quotes: Illiquid, no exchange trading, Model-based: Reprice using option models + bond curves, Issuer marks: Quarterly statements (may lag market moves), Independent valuation: Third-party pricing services (Markit, Bloomberg), Use: Latest market data (vol, rates, stock price), revalue components, Frequency: Daily for risk management, monthly/quarterly for client reporting, API design: POST /structured/decompose with {product_spec} returns components and values, POST /structured/payoff-analysis with {product, scenarios} returns payoff table and IRR, GET /structured/compare with {product, alternatives} recommends best option, POST /structured/mtm with {product, market_data} returns current fair value.',
    keyPoints: [
      'Decomposition: PPN = zero-coupon bond ($950) + call option ($50), reverse convertible = bond + short put, autocallable = bond + call options, value each component',
      'Embedded option: Total note - plain bond = option value (investor pays for optionality), compare to buying components separately (may be cheaper without structuring fee)',
      'Issuer credit risk: Structured note = unsecured debt, defaults → note worthless (Lehman 2008 → $0.08), deduct CVA = PD×LGD×Exposure, buy only strong issuers (AA+)',
      'Liquidity: No secondary market (hold to maturity), early exit = sell to issuer (wide bid-ask 5-10%), illiquidity premium 1-2% extra coupon, tax = ordinary income (not capital gains)',
      'Payoff analysis: Scenarios (best/worst/base/expected), calculate NPV and IRR, compare alternatives (stock, zero+call, cash), risk-adjusted returns (Sharpe ratio)',
    ],
  },
  {
    id: 'ed-q-3',
    question:
      'Implement a digital options trading system that: (1) Prices cash-or-nothing and asset-or-nothing digitals, (2) Calculates Greeks (delta has discontinuity at strike, gamma spikes), (3) Manages risk (digitals highly sensitive near expiry and strike), (4) Replicates digitals with spread strategies (tight call spread approximates digital), (5) Handles touch options (pays if level touched anytime, not just at expiry). Include: one-touch, no-touch, double-touch, target redemption forwards. How do you handle: delta hedging (delta jumps dramatically near strike)? Vega risk (extremely sensitive to volatility near strike)? Time decay (theta explodes near expiry)? Smile effects (digitals very sensitive to vol assumptions)?',
    sampleAnswer:
      'Digital options system: Pricing models: Cash-or-nothing call: Payoff: $C if S(T) > K, else $0, Formula: C × e^(-rT) × N(d2), where d2 from Black-Scholes, Example: $100 digital, strike $100, S=$100, T=1mo, σ=25%, r=5%, d2 = -0.125, N(d2) = 0.45, Price = $100 × e^(-0.05/12) × 0.45 = $44.81, Asset-or-nothing call: Payoff: S(T) if S(T) > K, else $0, Formula: S × e^(-rT) × N(d1), Example: Strike $100, S=$100, T=1mo, d1 = 0.094, N(d1) = 0.537, Price = $100 × e^(-0.05/12) × 0.537 = $53.47, Replication: Tight call spread: Long call @ K, Short call @ K+ε, As ε→0, payoff → digital, Width ε = $0.10 typical (narrow spread), Greeks calculation: Delta: ∂V/∂S = discontinuous at strike, Below strike: Delta ≈ 0, At strike: Delta spikes (infinite in limit), Above strike: Delta ≈ 0 (payoff already determined), Numerical: Delta = [V(S+ΔS) - V(S-ΔS)] / (2ΔS), use small ΔS = $0.01, Gamma: ∂²V/∂S² = extreme spike at strike, At-the-money: Gamma can be 100× higher than vanilla, Near expiry: Gamma → infinity (unbounded risk), Vega: ∂V/∂σ = sensitivity to volatility, Maximum at strike (50-50 chance of payout), Far from strike: Vega ≈ 0 (outcome nearly certain), Theta: ∂V/∂t = time decay, Near expiry + near strike: Theta extremely negative (rapid decay), Hours to expiry: Can lose 50% of value in last day, Risk management: Position limits: Max notional: $10M per digital (small size relative to portfolio), Proximity: No positions within $1 or 1 day of strike/expiry (extreme risk), Hedge bands: If S within 5% of K and T < 1 week: Reduce position or close, Delta hedging challenges: Delta jumps: At S=$99.90 (below strike), delta ≈ 5, At S=$100.10 (above strike), delta ≈ 95, cross strike → massive hedge adjustment, Dynamic: Hedge daily (or intraday near expiry), use tight spreads to smooth delta, Spread replication: Tight call spread: Buy call @ $100, Sell call @ $100.10, Payoff ≈ digital (pays $0.10 if > $100.10), Scale: 1000 spreads × $0.10 = $100 digital equivalent, Advantages: Smoother delta (no discontinuity), Lower gamma, easier to hedge, Costs: Slippage (two legs), slightly imperfect replication, Touch options: One-touch: Pays $C if S ever touches barrier B before T, else $0, Continuously monitored (more valuable than digital at expiry), Pricing: Barrier option formula, adjusted for rebate, Example: $100 one-touch, barrier $110, S=$100, T=3mo, Price ≈ $40 (depends on volatility), No-touch: Pays $C if S never touches barrier, opposite of one-touch, Used for range-bound views, Double-touch: Pays if S touches either upper OR lower barrier, Requires volatility (need big move in either direction), Target redemption forward (TARF): Structure: Forward contracts accumulate, terminate if total profit ≥ target, Example: EUR/USD forwards, terminate if cumulative profit $1M, Components: Strip of forwards + knock-out barrier (on cumulative), Pricing: Path-dependent (Monte Carlo required), Vega risk: Volatility sensitivity extreme: Small vol change → large price impact, Example: σ = 25% → 27% (2% increase), Digital price: $45 → $48 (+6.7%), Near strike: Even more sensitive (20% price move), Hedging: Trade offsetting digitals (different strikes to balance vega), Use vanilla options (positive vega to offset negative vega digitals), Smile effects: Digital very sensitive to vol assumptions: Assume flat vol: Digital price $45, Actual smile (higher vol at $110 strike): Digital price $42, Difference: -6.7% (significant), Pricing: Use strike-specific implied vol from smile, not ATM vol, Local vol surface: Required for accurate pricing, Time decay: Theta explosion near expiry: T = 1 week, θ = -$2/day, T = 1 day, θ = -$10/day, T = 1 hour, θ = -$50/hour (extreme), Management: Close positions 1 week before expiry (avoid theta explosion), Or accept theta as carry (if view remains intact), API design: POST /digital/price with {type, payoff, strike, maturity} returns price and greeks, GET /digital/greeks?product_id=X returns delta, gamma, vega, theta with warnings if extreme, POST /digital/replicate with {digital_spec} returns equivalent call spread parameters, POST /digital/touch with {barrier, type} prices one-touch/no-touch options.',
    keyPoints: [
      'Pricing: Cash-or-nothing C×e^(-rT)×N(d2), asset-or-nothing S×e^(-rT)×N(d1), replicate with tight call spread (buy K, sell K+ε, ε→0)',
      'Delta: Discontinuous at strike (0 below, 100 above), jumps dramatically crossing strike, hedge daily with tight spreads (smooth delta), numerical calc with small ΔS=$0.01',
      'Gamma: Extreme spike at strike (100× vanilla), near expiry → unbounded, position limits (max $10M, no positions within $1 or 1 day of K/T)',
      'Vega: Maximum at strike (50-50 payout), σ 25%→27% (2pt) can cause 6-7% price move, use strike-specific implied vol from smile (not flat ATM vol)',
      'Theta: Explodes near expiry (T=1wk θ=-$2/day, T=1day θ=-$10/day, T=1hr θ=-$50/hr), close 1 week before expiry to avoid gamma/theta explosion',
    ],
  },
];
