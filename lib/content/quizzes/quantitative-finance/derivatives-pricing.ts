export const derivativesPricingQuiz = [
  {
    id: 'dp-q-1',
    question:
      'Explain forward pricing under no-arbitrage and identify arbitrage opportunities. Given: Stock S=$100, dividend yield q=2%, risk-free rate r=5%, T=1 year. Forward trades at F=$106. (1) Derive the fair forward price using no-arbitrage, (2) show whether F=$106 is overpriced or underpriced, (3) construct the arbitrage strategy with specific positions and cash flows, (4) calculate the risk-free profit, (5) explain the relationship between contango, backwardation, and convenience yield for commodity futures.',
    sampleAnswer: `Forward Pricing and Arbitrage: (1) FAIR FORWARD PRICE DERIVATION: No-arbitrage principle: Two strategies delivering identical payoff must cost the same. Strategy A (Synthetic forward): Borrow $100 at rate r, buy stock at $100, hold until T=1 year. Cost at T: Repay loan = $100*e^(rT) = $100*e^(0.05) = $105.13. Benefit: Receive dividends = $100*q*e^(qT) ≈ $100*(0.02) = $2 (continuous yield). Net cost at T = $105.13 - $2 = $103.13. Strategy B (Forward contract): Enter long forward at price F. Cost at T = F. No-arbitrage requires: F = S*e^((r-q)T) = $100*e^(0.03*1) = $103.05. (2) MISPRICING ANALYSIS: Market forward = $106, Fair forward = $103.05. Forward is OVERPRICED by $106 - $103.05 = $2.95 per share. (3) ARBITRAGE STRATEGY (exploit overpricing): When forward overpriced: Short the expensive (forward), Long the cheap (synthetic long via stock). Positions TODAY (t=0): Short forward at F=$106 (agree to sell stock at $106 in 1 year, no cash flow today), Buy 100 shares at $100 (pay $100), Borrow $100 at r=5% (receive $100). Net cash flow TODAY = $0 (self-financing). Positions at MATURITY (t=1): Deliver 100 shares via forward contract: Receive $106, Dividends received during year: $2, Repay loan: $105.13. Net cash at maturity = $106 + $2 - $105.13 = $2.87 RISK-FREE PROFIT per share. (4) PROFIT CALCULATION: Per share profit = $2.87. For 100 shares = $287 risk-free profit. Return = $287 / $0 initial investment = infinite! (zero capital required). Present value of profit = $287*e^(-0.05*1) = $272.90 per 100 shares. This is arbitrage: zero risk, zero net investment, positive profit. (5) CONTANGO, BACKWARDATION, CONVENIENCE YIELD: General forward formula with carry costs: F = S*e^((r+c-q-y)T). Where: r=risk-free rate, c=storage cost, q=dividend/income yield, y=convenience yield (benefit of physical ownership). CONTANGO (F > S): Forward price above spot. Normal for financial assets and storable commodities. Example: Gold futures. No dividends (q=0), storage cost c=1%. F = $100*e^((0.05+0.01)T) = $106.18 > S=$100. Storage costs push futures above spot. BACKWARDATION (F < S): Forward price below spot. Occurs when convenience yield dominates (y > r+c-q). Example: Crude oil during shortage. S=$80/barrel, but 3-month future F=$78. Implied convenience yield: y = 0.08 (8%). Producers willing to pay 8% premium to hold physical oil NOW (avoid production shutdowns, immediate delivery value). Theory: Backwardation when: Inventory low → high convenience yield, Immediate demand > future expected demand, Strong seasonal demand (natural gas in winter). Contango when: Inventory high → low convenience yield, Future demand > current demand, Easy storage (financial assets, gold). REAL EXAMPLE (Crude Oil 2020 COVID): April 2020: WTI crude futures went NEGATIVE ($-37/barrel). Spot physical oil ~$20, 1-month future $15, 2-month future $25. Extreme backwardation (negative roll yield for long futures). Storage full → negative convenience yield, couldn't take physical delivery → futures plummeted. This illustrates: Convenience yield can be negative (storage burden exceeds holding benefit), Backwardation can be extreme (steep downward slope), Physical constraints matter (delivery location, storage capacity).`,
    keyPoints: [
      'Fair forward price: F = S*e^((r-q)T) = $103.05; market F=$106 is overpriced by $2.95',
      'Arbitrage: Short forward at $106, buy stock at $100 (borrow to fund), profit $2.87 risk-free',
      'Contango (F > S): Normal for financial assets, storage costs dominate (gold, equities)',
      'Backwardation (F < S): Convenience yield exceeds carry cost (oil shortages, low inventory)',
      'Extreme backwardation: 2020 oil crisis, negative prices when storage full & delivery forced',
    ],
  },
  {
    id: 'dp-q-2',
    question:
      'Value an interest rate swap and explain its use for hedging. Setup: 3-year swap, notional $10M, fixed rate 5%, floating SOFR currently 4.5%. (1) Explain swap mechanics: who pays what and when, (2) value the swap from the perspective of the fixed-rate payer, (3) calculate the swap rate (par rate) that makes initial value zero, (4) show how a corporation with floating-rate debt uses swaps to hedge interest rate risk, (5) discuss credit risk (CVA) and why swap values change with counterparty credit quality.',
    sampleAnswer: `Interest Rate Swap Valuation and Hedging: (1) SWAP MECHANICS: Interest rate swap: Exchange fixed interest payments for floating interest payments. Structure: Notional principal: $10M (NOT exchanged, only used to calculate interest). Fixed leg: One party pays fixed rate 5% annually on $10M = $500K/year. Floating leg: Other party pays floating SOFR on $10M, reset every payment period. Payment frequency: Typically quarterly or semi-annual. Net settlement: Only difference is exchanged. Example payment (year 1, SOFR=4.5%): Fixed payer pays: $10M * 5% = $500K, Floating payer pays: $10M * 4.5% = $450K, Net payment: Fixed payer pays $50K to floating payer. (2) SWAP VALUATION (Fixed-rate payer perspective): Fixed-rate payer = Long floating-rate bond + Short fixed-rate bond. Value of swap to fixed payer: V_swap = V_floating - V_fixed. FLOATING LEG VALUATION: Floating-rate bond always worth par (\$10M) at reset date. After each payment, resets to par (next coupon = current SOFR). V_floating = $10M. FIXED LEG VALUATION: Present value of fixed payments: Annual payment = $10M * 5% = $500K. Discount at current SOFR term structure (yield curve). Assume flat SOFR curve at 4.5% for simplicity: V_fixed = $500K/(1.045) + $500K/(1.045)^2 + $500K/(1.045)^3 + $10M/(1.045)^3 = $478.47K + $457.95K + $438.23K + $8,762,97K = $10,137.62K. SWAP VALUE: V_swap = $10,000K - $10,137.62K = -$137.62K. Negative value: Fixed payer LOSES $137.62K (paying above-market fixed rate). To close out: Would need to pay $137.62K to counterparty. (3) PAR SWAP RATE (Makes V_swap = 0): Par rate R such that V_fixed = V_floating = $10M. Present value of annuity: $10M = R * $10M * [1/(1.045) + 1/(1.045)^2 + 1/(1.045)^3]. Let A = annuity factor = [1/(1.045) + 1/(1.045)^2 + 1/(1.045)^3] = 0.9569 + 0.9157 + 0.8763 = 2.7489. Solving: $10M = R * $10M * 2.7489. R = 1 / 2.7489 = 0.0364 = 3.64%. Wait, this assumes principal exchanged. Correct formula: R = (1 - Z(3)) / [Z(1) + Z(2) + Z(3)]. Where Z(t) = discount factor = 1/(1.045)^t. Z(1) = 0.9569, Z(2) = 0.9157, Z(3) = 0.8763. R = (1 - 0.8763) / (0.9569 + 0.9157 + 0.8763) = 0.1237 / 2.7489 = 4.5%. PAR SWAP RATE = 4.5% (equals current SOFR, so swap has zero initial value). The 5% fixed rate is above par (4.5%), hence negative value to fixed payer. (4) CORPORATE HEDGING EXAMPLE: Corporation: Issued $10M floating-rate debt, pays SOFR + 100bps quarterly. Interest rate risk: If SOFR rises from 4.5% to 6%, interest cost rises from $550K to $700K/year. Unaffordable if revenues fixed. HEDGING WITH SWAP: Enter pay-fixed, receive-floating swap: Notional: $10M, Pay fixed: 5%, Receive floating: SOFR. Combined cash flows: Pay on debt: -(SOFR + 1%), Receive from swap: +SOFR, Pay on swap: -5%, NET: -(SOFR + 1%) + SOFR - 5% = -6%. Result: FIXED total interest cost of 6%, regardless of SOFR level. If SOFR rises to 7%: Debt interest: $800K, Receive from swap: $700K (SOFR), Pay on swap: $500K (fixed), Net: $800K - $700K + $500K = $600K = 6% on $10M (same as before!). Protection against rising rates. (5) CREDIT RISK AND CVA: Credit Valuation Adjustment (CVA): Adjustment to swap value for counterparty default risk. Swap has bilateral credit risk: If swap has positive value to you, counterparty owes you money → exposure to their default, If swap has negative value to you, you owe counterparty → they have exposure to your default. CVA calculation: CVA = Expected Loss = Probability of Default (PD) * Loss Given Default (LGD) * Exposure at Default (EAD). Example: Swap value to you: +$200K (counterparty owes you). Counterparty credit spread: 200bps (2% above risk-free). Implies 5-year cumulative PD ≈ 8-10%. Recovery rate: 40%, so LGD = 60%. Expected loss: $200K * 10% * 60% = $12K. Adjusted swap value = $200K - $12K = $188K (CVA reduces value by $12K). Impact on pricing: When entering swap with risky counterparty: Require better swap rate (higher rate if paying fixed, lower if receiving fixed). Or post collateral (CSA agreement): Daily margin calls, Net exposure reduced to daily moves (~$10K instead of $200K). Modern practice: Central clearing (CME, LCH), Eliminates bilateral risk, Pay variation margin daily, But pay clearing fees (~$5K/year per $10M notional). Why values change with credit quality: Counterparty downgrade (S&P AA → BBB): CVA increases from $5K to $30K, Swap value to you decreases by $25K (same expected payoffs, higher credit adjustment). Your own credit improves: If you owe money (negative swap value), your DVA (Debt Value Adjustment) increases, Net swap value improves (you benefit from your own credit risk!).`,
    keyPoints: [
      'Swap value to fixed payer = V_floating - V_fixed; V_floating=$10M, V_fixed=$10.14M → V_swap=-$137K',
      'Par swap rate (zero initial value) = 4.5% equals current SOFR; 5% fixed is above-market',
      'Corporate hedging: Pay fixed on swap + floating on debt → net fixed cost (6% in example)',
      'CVA adjusts swap value for counterparty default risk (PD * LGD * exposure)',
      'Modern practice: Central clearing with daily margin eliminates bilateral credit risk',
    ],
  },
  {
    id: 'dp-q-3',
    question:
      "Analyze exotic options: barrier, Asian, and lookback options. (1) Explain the payoff structure and when each exotic is useful, (2) why barrier options are cheaper than vanilla options, (3) value an up-and-out call (S=$100, K=$100, barrier=$120, T=1 year, r=5%, σ=30%) using Monte Carlo simulation approach, (4) discuss path-dependency and why closed-form solutions often don't exist, (5) describe hedging challenges with exotic options (discontinuous Greeks, gamma jumps near barriers).",
    sampleAnswer: `Exotic Options Analysis: (1) PAYOFF STRUCTURES AND USES: BARRIER OPTIONS (Knock-in, Knock-out): Up-and-out call: Vanilla call that DISAPPEARS if stock hits barrier $120. Payoff at expiration: If S never hit $120 during life: max(S_T - K, 0). If S ever hit $120: $0 (option knocked out, worthless). Use case: Cheaper than vanilla (sell upside beyond barrier). Example: Bull investor expects SPY $100 → $115, but not $120+. Buy up-and-out call K=$100, barrier=$120 for $4 (vs vanilla $6). If right: Same profit, save $2 premium. If SPY spikes to $122: Knocked out, lose everything (vanilla would be worth $22). Down-and-in put: Put that only ACTIVATES if stock falls below barrier. Payoff: If S ever hit barrier $80 during life: max(K - S_T, 0) at expiration (now vanilla put). If S never hit $80: $0 (never activated). Use case: Cheap downside protection if crash occurs. Example: Protective put on TSLA $100. Vanilla $90 put costs $5. Down-and-in put with barrier $92 costs $2 (cheaper). Protection only kicks in if TSLA drops below $92 (signaling real trouble). ASIAN OPTIONS (Average price): Payoff based on AVERAGE stock price over life: Call: max(S_avg - K, 0). Put: max(K - S_avg, 0). S_avg = (1/n) * Σ S_i (arithmetic average of n observations). Use case: Reduce manipulation risk, smoother payoff. Example: Corporate hedging FX exposure over quarter. Revenue depends on average USD/EUR rate, not just end rate. Buy Asian call on USD/EUR (payoff based on 90-day average rate). Prevents single-day spike from causing loss. Also used: Commodity producers (oil price averaging over month), Reduces impact of spot volatility (S_avg has lower vol than S_T), Cheaper than vanilla (lower volatility → lower value). LOOKBACK OPTIONS: Payoff based on MAXIMUM or MINIMUM price achieved: Lookback call: S_T - S_min (profit from buying at lowest price during life). Lookback put: S_max - S_T (profit from selling at highest price during life). Example: S_0=$100, over 1 year S_min=$90, S_max=$130, S_T=$110. Lookback call payoff: $110 - $90 = $20 (as if bought at perfect bottom). Lookback put payoff: $130 - $110 = $20 (as if sold at perfect top). Use case: Maximum regret mitigation. Trader knows they can't time market perfectly. Lookback option guarantees optimal execution price. Very expensive (captures maximum favorable price). (2) WHY BARRIER OPTIONS ARE CHEAPER: Barrier options have LESS OPTIONALITY than vanilla: Up-and-out call loses value in two ways: (1) Expiration below strike (like vanilla), (2) Ever hitting barrier during life (unique to barrier). Probability of knockout: For up-and-out call with barrier H > S: P(knockout) = (S/H)^(2μ/σ^2). Where μ = r - σ^2/2. Example: S=$100, H=$120, r=5%, σ=30%. μ = 0.05 - 0.30^2/2 = 0.05 - 0.045 = 0.005. P(knockout) = (100/120)^(2*0.005/0.09) = 0.833^0.111 = 0.98. Wait, that seems too high. Recalculate: P(knockout) formula for geometric Brownian motion: P(hit H before T) = (S/H)^(-2μ/σ^2). For S=100, H=120, μ=0.05, σ=0.30: P(hit 120) = (100/120)^(-2*0.05/0.09) = 0.833^(-1.11) = 1.24. This exceeds 1, formula error. Correct formula: P(knockout) ≈ 1 - N(d) where d depends on drift. Simplified: Higher barrier → Higher knockout probability → Lower option value. Typical discount: 20-40% cheaper than vanilla. Up-and-out call at K=$100, barrier=$120: Vanilla: $6.00, Barrier: $4.00 (33% cheaper). Reason: Gives up gains beyond $120 (knockout region). (3) MONTE CARLO VALUATION (Up-and-out call): Parameters: S=$100, K=$100, H=$120, T=1, r=5%, σ=30%. Simulation algorithm: Generate N paths (e.g., 10,000) of daily stock prices using GBM: S(t+dt) = S(t) * exp[(r - σ^2/2)*dt + σ*sqrt (dt)*Z]. Where Z ~ N(0,1), dt = 1/252 (daily steps). For each path i: Check if S ever exceeds $120 during 252 days, If YES: Payoff_i = 0 (knocked out), If NO: Payoff_i = max(S_T - 100, 0) at expiration. Average payoff: Avg = (1/10000) * Σ Payoff_i. Discounted value: V = e^(-rT) * Avg. Sample results: 10,000 paths → 3,500 paths hit barrier (35% knockout). 6,500 paths survive → average payoff of survivors = $15. Overall average: 0.65 * $15 = $9.75. Discounted: $9.75 * e^(-0.05*1) = $9.75 * 0.9512 = $9.27. Barrier option value ≈ $9.27 vs vanilla ≈ $13.00 (29% discount). (4) PATH-DEPENDENCY & NO CLOSED-FORM: Path-dependent: Payoff depends on ENTIRE price path, not just terminal price S_T. Vanilla option: Only S_T matters (path-independent). Asian option: S_avg depends on all S(t) from 0 to T. Lookback: S_max and S_min depend on all S(t). Barrier: Whether S ever hit H depends on max(S(t)) over [0,T]. Why no closed-form: Black-Scholes PDE assumes payoff = f(S_T). Path-dependent payoff = f(S_0, S_1, ..., S_T) (infinite-dimensional). Cannot reduce to single state variable. Exception: Geometric Asian option (S_geometric_avg) has closed-form (lognormal). Arithmetic Asian requires numerical methods. Valuation methods: Monte Carlo (best for path-dependent): Simulate full paths, Easy to implement any exotic, Slow for Greeks (finite differences). Finite difference PDE: Solve PDE with path-augmented state space (e.g., add running average as state variable), Fast for Greeks, Complex to implement. Binomial/Trinomial trees: Discretize time and price, Track barrier hits at each node, Moderate speed and accuracy. (5) HEDGING CHALLENGES: DISCONTINUOUS GREEKS: Delta jump near barrier: As S approaches barrier H=$120 from below: Deep in-the-money call (S=$119): High delta (~0.8), option very valuable. Instantly at barrier (S=$120): Knockout → Delta = 0 (option worthless). Delta discontinuity: From 0.8 to 0 instantly (impossible to hedge dynamically). Gamma becomes infinite at barrier: Gamma = d(Delta)/dS → undefined at S=H (discontinuous delta). Vega also discontinuous: Below barrier: High vega (volatility increases knockout probability). At barrier: Vega = 0 (already knocked out). HEDGING STRATEGY: Use vanilla options to approximate: Buy vanilla call K=$100 (positive delta). Sell vanilla call K=$120 (negative delta for upside). Net: Approximates barrier payoff (low delta near $120). Add digital option at $120: Pays $1 if S > $120 (hedge knockout jump). Position: Short digital at barrier → offsets discrete loss when knocked out. Dynamic rebalancing: Near barrier (S=$118-$119): Increase hedge frequency (daily → hourly). Monitor realized vol vs implied (gap widens near barrier). Use stop-loss orders: If S hits $119.50 → Pre-emptively close position (avoid gamma blowup at $120). REAL EXAMPLE (2015 SNB de-peg): Swiss National Bank held EUR/CHF at 1.20 (barrier). Many knock-out options at 1.20 barrier. Jan 15, 2015: SNB removed floor, EUR/CHF gapped from 1.20 → 0.98 instantly. All knock-out options near 1.20 barrier → Instant loss, no hedge possible (gap through barrier). Lesson: Barrier hedging requires: Wide berth from barrier (close position at H - 2% buffer), Tail risk insurance (far OTM vanilla calls), Accept discrete risk (some jumps unhedgeable).`,
    keyPoints: [
      'Barrier options: Cheaper (20-40%) than vanilla by giving up payoff beyond barrier (knockout)',
      'Asian options: Payoff based on average price (reduces manipulation, lower vol → cheaper)',
      'Monte Carlo for barriers: Simulate 10K paths, check barrier hits, avg payoff, discount back',
      'Path-dependency prevents closed-form (payoff depends on full path, not just S_T)',
      'Hedging challenges: Delta discontinuity at barrier (0.8 → 0), infinite gamma, requires buffer zone',
    ],
  },
];
