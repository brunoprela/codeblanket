export const impliedVolatilityQuiz = [
  {
    id: 'implied-volatility-q-1',
    question:
      'Design a "volatility surface trading system" that identifies mispricing opportunities across the entire options chain. The system should: (1) Calculate implied volatility for all strikes and expirations, (2) Fit a smooth volatility surface using SABR or SVI model, (3) Detect options with IV significantly above/below the surface, (4) Recommend arbitrage trades (buy cheap, sell expensive options), (5) Account for bid-ask spreads and transaction costs, (6) Backtest on historical data to measure profitability. Explain why volatility surfaces exist, how to model them, and practical trading strategies.',
    sampleAnswer:
      'Volatility Surface Trading System: **Volatility Surface Basics**: 3D surface: IV = f(strike, time_to_expiration). Strike dimension: Volatility smile/skew (OTM puts expensive). Time dimension: Term structure (short vs long-dated vol). Reality: Surface is NOT flat, varies by market conditions. **Data Collection**: Collect entire options chain: For each expiration (7, 14, 30, 60, 90, 180, 365 days), Get all strikes (-30% to +30% from spot), Record: bid, ask, mid, volume, open interest. Calculate IV for each: Use Newton-Raphson on mid-prices, Store in 2D grid: IV[strike, expiration]. **Surface Fitting Models**: Option 1 - SABR Model (Stochastic Alpha Beta Rho): Most popular for interest rates and FX, 4 parameters: α (volatility level), β (backbone, usually 0.5-1.0), ρ (correlation), ν (vol of vol). Fits smile/skew well, Complex calibration (nonlinear optimization). Option 2 - SVI (Stochastic Volatility Inspired): Simpler, 5 parameters per expiration, Formula: IV² = a + b[ρ(k-m) + √((k-m)² + σ²)], where k = log-moneyness = ln(K/F). Arbitrage-free constraints, Faster calibration. **Implementation**: def fit_volatility_surface(option_chain_data): surface = {}; for expiry in expirations: strikes, ivs = get_ivs_for_expiry(expiry); # Fit SVI to this expiry\'s smile; params = calibrate_svi(strikes, ivs); surface[expiry] = params; return surface. **Mispricing Detection**: Calculate theoretical IV from surface: iv_theoretical = svi_formula(strike, params); Get market IV: iv_market = market_implied_vol; Deviation: diff = abs(iv_market - iv_theoretical); If diff > threshold (e.g., 2% absolute or 10% relative): Flag as mispricing. **Arbitrage Strategy**: Case 1 - Option too cheap: Market IV < Surface IV by > 2%. Trade: BUY option (cheap relative to surface). Expectation: IV reverts to surface → option gains value. Example: Surface says 100 strike should be 21% IV, Market shows 18% IV → Buy option. Case 2 - Option too expensive: Market IV > Surface IV by > 2%. Trade: SELL option (expensive premium). Hedge: Delta-neutral with stock or other options. **Transaction Cost Adjustment**: Per option contract: Commission: $0.65 retail, $0.10 institutional. Slippage: (ask - bid) / 2, typically $0.02-0.10. Round-trip: 2 × ($0.65 + slippage). Minimum profit threshold: Must exceed transaction costs. Example: If deviation = $0.30 but costs = $0.80 → skip trade. **Risk Management**: Position limits: Max 100 contracts per strike, Max $50K vega exposure total. Hedging: Maintain delta-neutral (hedge with stock), Limit net vega exposure. Stop losses: Exit if option moves against by 50% of initial profit expectation. **Backtest Framework**: Historical dataset: Daily options chain snapshots 2020-2024. Simulation: For each day: Fit surface, Detect mispricings, Simulate trades (at midpoint + slippage), Hold for X days (e.g., 5 days), Exit (assume mean reversion). Track P&L: Measure: Sharpe ratio, win rate, max drawdown. Results (example): 1000 trades identified, Win rate: 62%, Avg profit: $250, Avg loss: -$180, Expected value: 0.62×$250 - 0.38×$180 = $155 - $68 = $87 per trade, Annual return: 18% on capital. **Why Volatility Surfaces Exist**: Supply/demand imbalances: Hedgers buy OTM puts (portfolio insurance) → OTM put IV elevated. Leverage effect: Stock down → debt-to-equity up → volatility up → correlation. Fat tails: Market crashes more common than normal distribution predicts. Jump risk: Discrete events (earnings, news) create jumps. **Surface Modeling Best Practices**: No-arbitrage constraints: Ensure calendar spreads don\'t violate arbitrage (longer-dated > shorter), Ensure butterfly spreads positive. Regularization: Smooth surface (penalize roughness in optimization). Weighting: Weight liquid strikes more (high volume/open interest), Ignore wide bid-ask spreads. **Practical Trading Strategies**: Calendar arbitrage: If 30-day IV > 60-day IV (unusual), Sell 30-day, buy 60-day → profit when normalizes. Butterfly arbitrage: If OTM IVs too high relative to ATM, Sell OTM butterfly → collect elevated premium. Cross-strike: If 105 strike IV = 19% but neighbors at 20-21%, Buy 105 strike (cheap). **Production System**: Real-time fitting: Refit surface every 60 seconds (balance speed vs accuracy). Alert system: Email/SMS when mispricing > threshold. Auto-execution: Submit orders via API (with approval). Monitoring: Dashboard showing: Surface 3D plot, Detected mispricings, Active positions P&L. **Advanced Considerations**: Earnings events: IV spikes before earnings, collapses after (vol crush), Separate model for earnings vs non-earnings. Weekends: IV drops over weekends (theta decay), Adjust surface for days-to-expiration. Market regimes: Different surfaces in high vs low VIX regimes, Adaptive parameters.',
    keyPoints: [
      'Volatility surface: 3D structure IV = f(strike, time); fit using SABR or SVI models to smooth noise',
      'Mispricing detection: Compare market IV to theoretical surface IV; trade when deviation > 2%',
      'Arbitrage: Buy options below surface (cheap IV), sell options above surface (rich IV)',
      'Transaction costs critical: Need $0.80+ profit per contract to break even after commissions and slippage',
      'Surface exists due to supply/demand, fat tails, leverage effect; models must respect no-arbitrage',
    ],
  },
  {
    id: 'implied-volatility-q-2',
    question:
      'Explain the concept of "VIX futures" and design a "VIX trading strategy" that profits from volatility mean reversion. The system should: (1) Monitor VIX level and calculate historical Z-score, (2) Identify extreme deviations (VIX > 30 or VIX < 12), (3) Trade VIX futures or options to profit from reversion, (4) Implement proper position sizing based on volatility of VIX itself, (5) Hedge with S&P 500 positions (negative correlation). Discuss VIX term structure (contango vs backwardation), VIX ETFs (VXX, UVXY), and why VIX mean-reverts.',
    sampleAnswer:
      'VIX Trading System Design: **VIX Fundamentals**: VIX = CBOE Volatility Index = 30-day implied volatility of S&P 500 options. Calculated from: SPX option prices across multiple strikes, Weighted average of IVs, Annualized percentage. Properties: Mean-reverting around 15-20, Negative correlation with S&P 500 (-0.70 to -0.80), Spikes during market stress, Then decays back to mean. **VIX Z-Score Calculation**: Measures how many standard deviations VIX is from its mean: Z = (VIX_current - VIX_mean) / VIX_std. Lookback period: 252 trading days (1 year). Algorithm: def calculate_vix_zscore(vix_history): mean = np.mean(vix_history[-252:]); std = np.std(vix_history[-252:]); current = vix_history[-1]; zscore = (current - mean) / std; return zscore, mean, std. Interpretation: Z > +2: VIX extremely high (sell vol), Z > +1: VIX elevated (consider selling), |Z| < 1: Normal range (no trade), Z < -1: VIX low (consider buying), Z < -2: VIX extremely low (buy vol). **Mean Reversion Strategy**: Core thesis: VIX always returns to 15-20 range eventually. Trade: When VIX > 30 (high): Short VIX futures or buy inverse VIX ETPs → profit as VIX falls. When VIX < 12 (low): Long VIX futures or calls → profit when VIX spikes. Position sizing: Inversely proportional to VIX level (lower position size when VIX high = more volatile). **VIX Futures Mechanics**: VIX futures ≠ VIX spot: Futures trade at premium or discount to spot, Term structure matters (contango vs backwardation). Contango (normal): Front month < back month (e.g., VIX spot 15, 1-month future 16, 2-month 17). Negative carry for long positions (futures converge down to spot). Backwardation (rare, during stress): Front month > back month (VIX spot 40, 1-month 38, 2-month 35). Positive carry for long positions. **Trading Implementation**: Extreme High (VIX > 30, Z > +2): Trade: Short 1-month VIX futures. Logic: VIX will decay from elevated levels, Futures will converge down to spot. Risk: VIX can spike higher (2008: 40 → 80), Stop loss: Exit if VIX rises 20% from entry. Example: VIX at 35, short VIX futures at 36, One month later: VIX at 20, futures at 21, Profit: 36 - 21 = 15 points × $1000/point = $15,000 per contract. Extreme Low (VIX < 12, Z < -2): Trade: Long VIX calls (defined risk). Logic: VIX likely to spike eventually, Calls cap downside (premium paid), Unlimited upside. Example: VIX at 11, buy 15-strike calls for $2, VIX spikes to 25, calls worth $10+, Profit: $10 - $2 = $8 per share × 100 = $800. **Position Sizing**: Account for VIX volatility (vol of vol): VIX itself is volatile (σ of VIX ≈ 80-100% annualized). Kelly criterion: Position size = Edge / Volatility². Conservative: Risk only 2-3% of capital per trade. Example: $100K account, VIX at 35, Risk 2% = $2K, VIX future = $35 × 1000 = $35K notional, Position: 1-2 contracts max (0.05 contracts per $1K risk). **S&P 500 Hedge**: VIX and SPX negatively correlated: When SPX down, VIX up (and vice versa). Hedge short VIX positions with SPX puts: If shorting VIX (betting on calm), Buy SPX puts (insurance against crash → VIX spike). Hedge ratio: $1 short VIX ≈ $0.30 long SPX puts. **VIX ETFs and ETPs**: VXX (iPath Series B S&P 500 VIX Short-Term Futures): Tracks 1-month VIX futures, Suffers from contango decay (loses value over time), NOT for long-term holding. UVXY (ProShares Ultra VIX Short-Term Futures): 1.5× leveraged VXX, Even more decay, Only for short-term tactical trades. SVXY (ProShares Short VIX Short-Term Futures): Inverse VIX (-0.5× daily return), Profits from contango, But crashes during VIX spikes (beware!). Warning: These are NOT buy-and-hold! Contango decay destroys value: VXX down 99% since inception despite VIX roughly flat. **Why VIX Mean-Reverts**: Fundamental reasons: Low VIX (< 12): Complacency → accidents happen → volatility spikes. High VIX (> 30): Fear → markets stabilize → volatility drops. Economic: Prolonged high volatility unsustainable (markets adapt). Statistical: Volatility is bounded (can\'t go below 0, rarely above 80). **Term Structure Trading**: Normal contango: Short front-month VIX, long back-month VIX, Profit from: Front decays faster due to contango, Roll yield. Backwardation (rare): Long front-month, short back-month, Profit from: Front premium over spot, Roll yield reversal. **Backtest Results (2010-2023)**: Strategy: Short VIX when Z > +2, long when Z < -2. Trades: 45 short signals, 28 long signals. Win rate: 71% on shorts, 68% on longs. Avg profit per trade: $8,500 (shorts), $3,200 (longs). Max drawdown: -$45K (March 2020 VIX spike to 82). Sharpe ratio: 1.4 (good). Annual return: 22% on capital. **Risk Management Critical**: VIX can spike 100-200% in days (March 2020: 15 → 82 in 2 weeks). Never: Short VIX without stops, Use excessive leverage, Hold through earnings season or Fed meetings. Always: Use defined-risk strategies (options, spreads), Size positions conservatively, Have crash hedges (SPX puts). **Advanced: VIX Option Strategies**: Instead of futures, use options: Long VIX calls (low VIX): Defined risk, unlimited upside. Short VIX put spreads (high VIX): Defined risk, profit from decay. VIX call spreads (moderate VIX): Reduce cost vs naked calls.',
    keyPoints: [
      'VIX mean-reverts to 15-20; trade extremes: short when VIX > 30 (Z > +2), long when VIX < 12 (Z < -2)',
      'VIX futures ≠ VIX spot; contango (normal) creates negative carry for longs, backwardation (rare) positive carry',
      'VIX ETFs (VXX, UVXY) suffer contango decay; NOT for long-term holding (VXX down 99% since inception)',
      'Position sizing: Account for high vol of VIX (80-100%); risk only 2-3% per trade due to extreme moves',
      'S&P 500 hedge: VIX negatively correlated (-0.70); hedge short VIX with SPX puts (~30% of notional)',
    ],
  },
  {
    id: 'implied-volatility-q-3',
    question:
      'Design an "IV rank trading system" that selects optimal options strategies based on current IV rank. The system should: (1) Calculate IV rank for each underlying (current IV vs 52-week range), (2) Classify IV regime (low < 25%, medium 25-75%, high > 75%), (3) Recommend strategy: sell premium in high IV, buy options in low IV, (4) Generate specific trade recommendations with strikes and expirations, (5) Track performance across different IV regimes, (6) Adjust position sizing based on IV regime. Explain why IV rank matters more than absolute IV level and how to build a robust IV-based trading system.',
    sampleAnswer:
      'IV Rank Trading System: **IV Rank Definition**: IV Rank = (IV_current - IV_52week_low) / (IV_52week_high - IV_52week_low) × 100. Measures: Where current IV sits in its historical range (0-100%). Why it matters: Absolute IV meaningless without context, 20% IV could be high for one stock, low for another. IV Rank normalizes across all underlyings. **IV Rank Calculation**: def calculate_iv_rank(current_iv, iv_history_52w): iv_min = np.min(iv_history_52w); iv_max = np.max(iv_history_52w); if iv_max == iv_min: return 50.0; iv_rank = (current_iv - iv_min) / (iv_max - iv_min) × 100; return iv_rank. **IV Regime Classification**: Low IV (IV Rank < 25%): Current IV in bottom quartile of 52-week range, Volatility compressed, cheap options, Strategy: BUY options (cheap premium, bet on vol expansion). Medium IV (IV Rank 25-75%): Normal range, fair value, Strategy: Neutral or skip, no strong edge. High IV (IV Rank > 75%): Current IV in top quartile, elevated volatility premium, Strategy: SELL options (collect inflated premium). **Strategy Recommendations by IV Rank**: LOW IV RANK (< 25%) - Buy Options: Long calls (bullish + cheap): Strike: ATM or slight OTM, Expiration: 30-45 days, Max risk: Premium paid. Long puts (bearish + cheap): Strike: ATM or slight OTM, Expiration: 30-45 days. Long straddle (expecting move): Strikes: Both ATM, Expiration: 30-45 days, Profit if: Stock moves > premium paid. Rationale: Options cheap, volatility likely to expand (IV mean-reverts upward). MEDIUM IV RANK (25-75%) - Neutral: Strategies: Calendar spreads (sell front, buy back), Iron condors (if leaning toward high), Covered calls (income generation). Rationale: No strong edge, focus on theta collection. HIGH IV RANK (> 75%) - Sell Premium: Short puts (bullish, collect premium): Strike: 5-10% OTM, Expiration: 30-45 days, Cash-secured or use margin. Short strangles (neutral): Strikes: OTM put + OTM call (e.g., 10% away), Expiration: 30-45 days, Defined risk: Use stop losses or spreads. Iron condors (defined risk): Strikes: Sell 10% OTM, buy 15% OTM (wings), Expiration: 30-45 days, Max profit: Credit received, max loss: Wing spread - credit. Rationale: Inflated premium, volatility likely to contract (IV mean-reverts downward). **Trade Generation Algorithm**: def generate_trade_recommendations(ticker): # Get current IV and history; current_iv = get_current_iv(ticker); iv_history = get_iv_history_52w(ticker); # Calculate IV rank; iv_rank = calculate_iv_rank(current_iv, iv_history); # Get underlying data; stock_price = get_stock_price(ticker); # Generate recommendations; if iv_rank < 25: strategy = \"Long Call\"; strike = round_to_strike(stock_price × 1.02); # 2% OTM; expiration = 30; action = \"BUY\"; quantity = calculate_position_size_buy(account_size, stock_price); elif iv_rank > 75: strategy = \"Short Put\"; strike = round_to_strike(stock_price × 0.90); # 10% OTM; expiration = 45; action = \"SELL\"; quantity = calculate_position_size_sell(account_size, strike); else: strategy = \"No strong edge\"; return None; recommendation = {\'ticker\': ticker, \'strategy\': strategy, \'action\': action, \'strike\': strike, \'expiration\': expiration, \'quantity\': quantity, \'iv_rank\': iv_rank, \'rationale\': f\"IV rank {iv_rank:.1f}% - {get_rationale(iv_rank)}\"}; return recommendation. **Position Sizing by IV Rank**: Low IV (buying): Risk 2-3% of account per trade (defined risk = premium). Position size = (Account × 0.02) / (Premium × 100). High IV (selling): Risk 5% of account per trade (higher probability, but undefined risk). Use: Cash-secured puts (collateral = strike × 100), Spreads for defined risk (max loss = spread width - credit). **Performance Tracking**: Separate P&L by IV regime: Low IV trades: Track: Win rate, avg profit, avg loss, best strategy type (calls vs puts vs straddles). High IV trades: Track: Win rate (should be higher, ~65-70%), theta collection, assignments. Compare: Are low IV buys profitable? (Need vol expansion), Are high IV sells profitable? (Need vol contraction + theta). Metrics: Total return by regime, Sharpe ratio by regime, Max drawdown by regime. **Backtest Example Results (2018-2023)**: Low IV Strategies (<25% IV Rank): Trades: 245, Win rate: 58%, Avg profit: $350, Avg loss: -$250, Expected value: $115 per trade, Annual return: 14%. High IV Strategies (>75% IV Rank): Trades: 180, Win rate: 68%, Avg profit: $280, Avg loss: -$420, Expected value: $56 per trade, Annual return: 22% (higher due to more capital deployed). **Why IV Rank > Absolute IV**: Example 1: Stock A: Current IV = 30%, 52-week range = 15-35%, IV Rank = 75% → HIGH (sell premium). Stock B: Current IV = 30%, 52-week range = 25-60%, IV Rank = 14% → LOW (buy options). Same absolute IV (30%), opposite strategies! Stock A\'s 30% is high for it (near top of range). Stock B\'s 30% is low for it (near bottom of range). **Robust System Requirements**: Data quality: Accurate IV history (at least 252 days), Clean option chain data (filter wide spreads). Universe: Trade 50-100 high-volume underlyings, Avoid low liquidity (open interest < 100). Rebalancing: Recalculate IV rank daily, Exit positions after 30-45 days (don\'t hold to expiration). Risk management: Max 10% of capital in options at once, Stop losses: 50% of premium for buys, 200% of credit for sells. **Advanced Features**: IV Percentile: In addition to rank, calculate percentile (% of days below current IV), More robust to outliers. Sector analysis: Compare IV rank across sector (relative value), Trade cheapest vs most expensive in sector. Event filtering: Avoid trading before earnings (IV spikes artificially), Separate earnings vs non-earnings IV. Term structure: Check if front-month or back-month IV is elevated, Trade calendar spreads accordingly.',
    keyPoints: [
      'IV Rank: (Current IV - 52w Low) / (52w High - Low) × 100; normalizes IV across underlyings',
      'Strategy selection: Buy options when IV Rank < 25% (cheap), sell premium when IV Rank > 75% (expensive)',
      'IV Rank > absolute IV: Same 30% IV could be high for one stock (rank 75%), low for another (rank 14%)',
      'Position sizing: Risk 2-3% on buys (defined risk), 5% on sells (higher probability but undefined risk)',
      'Backtest shows: High IV sells win 68% with 22% annual return; low IV buys win 58% with 14% return',
    ],
  },
];

