export const greeksDeltaGammaThetaVegaRhoQuiz = [
    {
        id: 'greeks-q-1',
        question:
            'Design a "dynamic delta hedging system" for a market maker who holds 1000 short ATM call contracts on SPY. The system should: (1) Calculate portfolio delta in real-time, (2) Determine optimal rehedge triggers (when portfolio delta exceeds thresholds), (3) Execute stock trades to maintain delta neutrality, (4) Account for transaction costs (commission + slippage), (5) Track cumulative hedging P&L vs unhedged scenario, (6) Implement gamma scalping (profit from rehedging). Explain the trade-off between hedging frequency and transaction costs, the role of gamma in rehedging frequency, and how market makers profit from managing options positions.',
        sampleAnswer:
            'Dynamic Delta Hedging System: **Position Setup**: Short 1000 ATM SPY call contracts, SPY at $450, Strike $450, 30 days to expiration, Initial delta per contract: -0.50 (short call), Portfolio delta: -0.50 × 1000 × 100 = -50,000 shares equivalent, Need to BUY 50,000 SPY shares to neutralize. **Real-Time Delta Calculation**: def calculate_portfolio_delta(positions, current_price): total_delta = 0; for pos in positions: option_delta = black_scholes_delta(current_price, pos.strike, pos.tte, pos.vol); position_delta = option_delta × pos.quantity × pos.multiplier; total_delta += position_delta; return total_delta. Current: portfolio_delta = calculate_portfolio_delta(short_calls, 450); hedge_shares = -portfolio_delta # Opposite sign to neutralize; print(f"Portfolio delta: {portfolio_delta:,.0f} shares"); print(f"Hedge: {'BUY' if hedge_shares > 0 else 'SELL'} {abs(hedge_shares):,.0f} shares"). **Rehedge Triggers**: Option 1 - Fixed threshold: Rehedge when |portfolio_delta| > 5,000 shares (10% of original). Option 2 - Percentage threshold: Rehedge when |portfolio_delta / original_delta| > 0.10 (10% change). Option 3 - Gamma-based: Rehedge_threshold = gamma × stock_move². Higher gamma → more frequent rehedging. Implementation: REHEDGE_THRESHOLD = 5000; current_delta = calculate_portfolio_delta(...); if abs(current_delta) > REHEDGE_THRESHOLD: execute_hedge_trade(current_delta). **Transaction Costs**: Per share: Commission: $0.001 per share ($1 per 1000 shares), Slippage: 0.01% of trade value (bid-ask spread + market impact), Total cost per 1000 shares: $1 + ($450 × 1000 × 0.0001) = $1 + $45 = $46. For rehedge of 5000 shares: Cost ≈ $230. **Hedging Frequency Trade-off**: Frequent hedging (tight threshold): Pros: Always near delta-neutral, lower directional risk. Cons: High transaction costs, many trades. Example: Rehedge every $0.50 SPY move → 100+ trades per day → $23,000+ in costs. Infrequent hedging (wide threshold): Pros: Lower transaction costs, fewer trades. Cons: Higher directional risk between rehedges. Example: Rehedge every $5 SPY move → 10 trades per day → $2,300 in costs. Optimal: Balance based on gamma (how fast delta changes). **Gamma Scalping Mechanism**: Market maker profits from rehedging in correct direction: If SPY goes UP: Portfolio delta becomes more negative (gamma effect), Rehedge by BUYING more shares at higher price, Then SPY goes DOWN: Those shares are worth less → loss?, NO! Option value decreased, so short call position profited. Net: Option P&L - hedge loss + theta premium = profit. Example: Day 1: SPY $450, delta -50,000, buy 50,000 shares at $450, Day 2: SPY $455 (+$5), new delta -55,000 (gamma increased delta), buy 5,000 more shares at $455, Day 3: SPY $450 (-$5), sell 5,000 shares at $450, Hedge loss: 5,000 × ($455 - $450) = -$25,000, But option value: Short call lost value when SPY up, gained it back, Plus theta decay: Collected premium, Net profit from gamma scalping ≈ $5,000 - $25,000 hedge + $30,000 option = $5,000. **Complete Hedging System**: class DeltaHedger: def __init__(self, positions, threshold=5000): self.positions = positions; self.hedge_shares = 0; self.threshold = threshold; self.trades = []; def calculate_delta(self, spot): return calculate_portfolio_delta(self.positions, spot); def check_rehedge(self, spot): current_delta = self.calculate_delta(spot); if abs(current_delta) > self.threshold: return True, current_delta; return False, current_delta; def execute_hedge(self, delta, spot): shares_to_trade = -delta - self.hedge_shares; cost = calculate_transaction_cost(shares_to_trade, spot); self.trades.append({"shares": shares_to_trade, "price": spot, "cost": cost}); self.hedge_shares += shares_to_trade; def update(self, new_spot): should_hedge, current_delta = self.check_rehedge(new_spot); if should_hedge: self.execute_hedge(current_delta, new_spot). **Simulation Results (30-day period)**: Scenario 1 - Unhedged: SPY volatility: 1% daily, P&L: -$125,000 (directional losses dominated), Max loss: -$250,000. Scenario 2 - Frequent hedging (1000 share threshold): Rehedges: 500 trades, Transaction costs: -$115,000, P&L: +$85,000 (after costs), Net: -$30,000 (costs too high). Scenario 3 - Optimal hedging (5000 share threshold): Rehedges: 50 trades, Transaction costs: -$11,500, Gamma scalping profit: +$50,000, Theta collection: +$100,000, Net: +$138,500. **Key Insights**: Market makers profit from: Theta decay (time premium collected), Gamma scalping (buying low, selling high via rehedging), Bid-ask spread (buy at bid, sell at ask). Transaction costs matter: Too frequent → costs eat profits, Too infrequent → directional risk. Optimal frequency depends on: Gamma (higher → rehedge more often), Volatility (higher → rehedge more often), Transaction costs (lower → can hedge more). **Production Considerations**: Real-time data: Sub-second quote updates, Execution: Smart order routing for best prices, Risk limits: Max delta exposure, max position size, Monitoring: Dashboard showing portfolio Greeks, Stress testing: What if SPY gaps 5%?, Regulatory: Maintain logs for compliance.',
        keyPoints: [
            'Portfolio delta: Sum of (option_delta × quantity × 100) across all positions; hedge with opposite stock position',
            'Rehedge triggers: When |portfolio_delta| exceeds threshold (e.g., 5,000 shares or 10% of original)',
            'Gamma scalping: Rehedging in direction of stock movement creates profits (buy low, sell high)',
            'Transaction costs: Balance hedging frequency vs costs; optimal depends on gamma and volatility',
            'Market maker profit: Theta decay + gamma scalping + bid-ask spread minus hedging costs',
        ],
    },
    {
        id: 'greeks-q-2',
        question:
            'Explain the theta-gamma relationship and design a "time decay arbitrage scanner" that identifies situations where theta is mispriced relative to gamma. The system should: (1) Calculate theoretical theta/gamma ratio for different option types, (2) Compare market-implied ratios to theoretical ratios, (3) Identify arbitrage opportunities where theta premium doesn\'t compensate for gamma risk, (4) Construct calendar spreads that exploit theta/gamma mispricing, (5) Backtest strategy on historical data. Discuss why high gamma options have high (negative) theta, the economic intuition, and practical trading strategies.',
        sampleAnswer:
            'Theta-Gamma Relationship Deep Dive: **Theoretical Relationship**: Black-Scholes shows: Θ + 0.5 × σ² × S² × Γ × r = 0 (for dividend-free European options). Simplified: Theta = -0.5 × σ² × S² × Gamma. Intuition: High gamma = high convexity = high optionality value = pay via theta decay. Economic meaning: Theta is the "rent" you pay for gamma\'s convexity. **Why High Gamma = High Theta**: Gamma represents profit potential from rehedging (gamma scalping). Theta represents time decay cost. High gamma options (ATM): Maximum convexity → can profit greatly from stock movement, Maximum theta → pay the most for that optionality. Example: ATM 30-day option, S=$100, K=$100: Gamma = 0.030, Theta = -$0.08/day, Ratio: Theta/Gamma = -0.08/0.030 = -2.67. Deep OTM option: Gamma = 0.005, Theta = -$0.01/day, Ratio: -0.01/0.005 = -2.00. ATM pays more theta per unit of gamma (expected for higher convexity). **Theoretical Theta/Gamma Ratio**: For European options: Ratio = -0.5 × σ² × S². For S=$100, σ=20%: Ratio = -0.5 × 0.04 × 10,000 = -200. This is theoretical daily theta per unit gamma. Market ratios should cluster around this. **Mispricing Scanner Algorithm**: def calculate_theta_gamma_ratio(option): theta = calculate_theta(...); gamma = calculate_gamma(...); ratio = theta / gamma if gamma > 0.0001 else None; return ratio; def find_mispricings(option_chain, theoretical_ratio): mispricings = []; for option in option_chain: market_ratio = calculate_theta_gamma_ratio(option); if market_ratio: deviation = (market_ratio - theoretical_ratio) / theoretical_ratio; if abs(deviation) > 0.20: # 20% deviation; mispricings.append({\'option\': option, \'market_ratio\': market_ratio, \'theoretical\': theoretical_ratio, \'deviation\': deviation}); return mispricings. **Arbitrage Opportunity Types**: Case 1 - Theta too high (ratio more negative than theoretical): Market overpricing time decay, Strategy: SELL options (collect excessive theta), Risk: Gamma exposure, but compensated by high theta. Case 2 - Theta too low (ratio less negative): Market underpricing time decay, Strategy: BUY options (cheap gamma relative to theta cost), Profit from gamma scalping to offset theta. **Calendar Spread Exploitation**: When near-term theta/gamma too high and far-term too low: Strategy: Sell near-term (expensive theta), buy far-term (cheap gamma). Setup: Sell 30-day ATM call (Theta=-0.08, Gamma=0.030), Buy 60-day ATM call (Theta=-0.05, Gamma=0.020), Net theta: -0.08 + 0.05 = -0.03 (positive, collecting decay), Net gamma: -0.030 + 0.020 = -0.010 (negative gamma). Profit mechanism: Near-term decays faster (high theta), Far-term retains value (lower theta), Close near expiration when theta advantage maximized. **Example Backtest**: Dataset: SPY options, 2020-2023, 1000+ expirations. Strategy: Identify when ATM theta/gamma ratio > theoretical by 30%, Sell ATM options, hedge with far-dated, Hold 10 days, close. Results: Win rate: 68%, Average profit: $250 per trade, Average loss: -$400 per trade (gamma spikes), Expected value: 0.68×$250 + 0.32×(-$400) = $170 - $128 = $42 per trade, Annual return: 15-20% on capital deployed. **Economic Intuition**: Theta-gamma relationship reflects risk-reward trade-off: Selling options: Collect theta (steady premium), Expose to gamma (risk of large moves). Buying options: Pay theta (bleed daily), Gain gamma (profit from volatility). Market equilibrium: Theta collected should compensate for gamma risk. Mispricing: When market fears (high vol regime): Theta premiums elevated, Ratios more negative, Good time to sell. When market complacent (low vol): Theta premiums compressed, Ratios less negative, Good time to buy. **Practical Trading Strategy**: Long Gamma, Short Theta (Buy Options): When: Expecting volatility spike (VIX < 15), Events: Earnings, FOMC, elections, Implementation: Buy ATM straddles, Profit: From gamma scalping when stock moves. Short Gamma, Long Theta (Sell Options): When: High volatility regime (VIX > 25), Expecting calm, Implementation: Sell OTM puts/calls, iron condors, Profit: From theta decay as options expire worthless. **Production Scanner Implementation**: Real-time calculation: Stream options quotes, Calculate theta/gamma for all strikes/expirations, Compare to theoretical ratios. Alerts: When deviation > 20%, Flag option for review, Suggest trade: Buy/sell recommendation. Risk management: Position limits (max vega exposure), Gamma limits (max convexity risk), Theta targets (daily premium collection goals). Backtesting: Test on historical data, Measure: Sharpe ratio, max drawdown, win rate, Optimize: Deviation threshold, holding period. **Advanced Considerations**: Volatility smile: Different strikes have different IVs → different theta/gamma relationships, Must adjust theoretical ratios by strike. Term structure: Front-month vs back-month volatility differences affect calendar spreads. Correlation: Theta and gamma change together with stock moves (not independent). Transaction costs: Frequent rebalancing can erode profits, Must be factored into expected value.',
        keyPoints: [
            'Theta-gamma relationship: Θ ≈ -0.5 × σ² × S² × Γ; high gamma requires high theta to compensate',
            'Economic intuition: Theta is "rent" paid for gamma\'s convexity; selling options = collect rent, expose to convexity risk',
            'Mispricing detection: Compare market theta/gamma ratios to theoretical; deviations >20% may be tradeable',
            'Calendar spreads: Exploit when near-term has excessive theta relative to gamma vs far-term',
            'Practical strategy: Sell options in high vol (elevated theta premiums), buy in low vol (cheap gamma)',
        ],
    },
    {
        id: 'greeks-q-3',
        question:
            'Design a "vega hedging strategy" for an options portfolio manager with mixed long and short positions across different strikes and expirations. The system should: (1) Calculate portfolio vega (aggregate across all positions), (2) Decompose vega by term structure (how much vega at each expiration), (3) Identify hedging instruments (which options to trade to neutralize vega), (4) Construct vega-neutral portfolio while maintaining delta neutrality, (5) Monitor and rehedge as volatility surface shifts. Explain the difference between vega risk and volatility risk, term structure of vega, and why professional traders care deeply about vega exposure.',
        sampleAnswer:
            'Vega Hedging System Design: **Portfolio Vega Calculation**: Portfolio holds: +100 contracts 30-day ATM calls (long vega), -200 contracts 30-day OTM calls (short vega), +50 contracts 90-day ATM puts (long vega). Calculate individual vegas: vega_30d_atm = calculate_vega(S=100, K=100, T=30/365, σ=0.20) = $10 per 1% vol, vega_30d_otm = calculate_vega(S=100, K=110, T=30/365, σ=0.22) = $6 per 1% vol, vega_90d_atm = calculate_vega(S=100, K=100, T=90/365, σ=0.25) = $18 per 1% vol. Portfolio vega = (+100 × $10) + (-200 × $6) + (+50 × $18) = $1,000 - $1,200 + $900 = $700 per 1% vol. Net: Long $700 vega → profit if volatility increases. **Vega Term Structure Decomposition**: Vega by expiration: 30-day exposure: +$1,000 - $1,200 = -$200 (short vega front month), 90-day exposure: +$900 (long vega back month). Insight: Portfolio is: Short front-month volatility (profit if near-term vol falls), Long back-month volatility (profit if far-term vol rises). This is a "term structure trade" betting on volatility curve steepening. **Vega vs Volatility Risk**: Vega risk: Exposure to IMPLIED volatility changes (how market prices risk). Measured by: Vega Greek (sensitivity to IV change). Example: If SPY IV goes from 20% to 25%, portfolio P&L = $700 × (+5%) = +$3,500. Volatility risk: Exposure to REALIZED volatility (actual stock movement). Measured by: Gamma (sensitivity to stock moves). Different: IV can spike without stock moving (fear) → vega P&L without gamma P&L. **Why Vega Matters to Professionals**: Volatility spikes are common: VIX can move 20-50% in single day (2020 crash: VIX 15 → 80). Large P&L swings: $1M vega exposure × 20% vol spike = $200K daily P&L. Correlation: All options\' IVs move together (systemic risk). Hard to hedge: Can\'t easily "short volatility" like you can short stock. **Vega Hedging Instruments**: Option 1 - Opposite strikes: Long ATM calls (high vega) vs short OTM calls (lower vega) = net vega. Use ratio: Need more OTM contracts to offset ATM vega. Option 2 - Calendar spreads: Buy long-dated (high vega), sell short-dated (lower vega). Neutralizes total vega but maintains term structure exposure. Option 3 - VIX futures: Direct volatility hedge, $1 VIX futures ≈ $1,000 vega exposure per contract. Not perfect: VIX is S&P 500 vol, your portfolio may differ. Option 4 - Variance swaps: Pure volatility exposure (no delta/gamma). Institutional only, expensive. **Constructing Vega-Neutral Portfolio**: Current: Portfolio delta = +5,000 shares, Portfolio vega = +$700 per 1% vol. Goal: Delta-neutral AND vega-neutral. Solution: Sell ATM options (high vega, near-zero delta) to neutralize vega: ATM option: vega=$10, delta=0.50. Sell 70 ATM calls: Vega hedge: -70 × $10 = -$700 (neutralizes vega), Delta impact: -70 × 0.50 × 100 = -3,500 shares. Adjust stock hedge: Originally need -5,000 shares for delta, After options: need -5,000 - (-3,500) = -1,500 shares. Final portfolio: Delta ≈ 0, Vega ≈ 0. **Monitoring Volatility Surface Shifts**: Volatility surface has 3 dimensions: Strike (volatility smile/skew), Time (term structure), Level (overall vol level). Shifts: Parallel shift: All IVs move up/down together → portfolio vega P&L. Skew shift: OTM puts become more expensive relative to ATM → need to rehedge if exposure to skew. Term structure shift: Front vs back month vols change differently → term structure rehedge. **Dynamic Rehedging Algorithm**: def monitor_vega(portfolio, vol_surface): current_vega = calculate_portfolio_vega(portfolio, vol_surface); if abs(current_vega) > VEGA_THRESHOLD: hedge_vega(portfolio, current_vega); # Track term structure: vega_by_expiry = calculate_vega_by_term(portfolio); if is_term_structure_risk_high(vega_by_expiry): rehedge_term_structure(portfolio). Thresholds: Total vega: Keep within ±$500, Term structure: No single expiry > 50% of total vega, Skew: Monitor OTM put vs ATM call ratio. **Example Rehedge Scenario**: Day 1: Portfolio vega = +$700, VIX = 18. Day 2: VIX spikes to 25 (+39%), Portfolio P&L from vega = $700 × 7% ≈ +$4,900, New portfolio vega (vega itself changes): Now +$900 (vega increases as IV rises). Decision: Take profit (sell some long vega positions), Reset to neutral (hedge back to ±$200 vega target). **Advanced: Volatility Surface Hedging**: Beyond simple vega: Vanna: Sensitivity to both stock price AND volatility (∂²C/∂S∂σ), Volga/Vomma: Sensitivity to volatility of volatility (∂²C/∂σ²). Professional approach: Hedge not just vega, but also vanna and volga, Requires: Options across multiple strikes and expirations. **Production System Components**: Real-time vega calc: Update every second with quote changes, Greeks engine: Calculate vega for 1000+ positions instantly, Alert system: Notify when vega exceeds limits, Auto-hedging: Execute hedge trades automatically (with approval), P&L attribution: Separate vega P&L from delta P&L, Stress testing: What if VIX jumps 10 points? **Practical Insights**: Market makers: Keep vega near zero (don\'t want vol exposure), Hedge frequently. Volatility traders: Deliberately take vega exposure, Hedge only extremes, profit from vol moves. Portfolio managers: Accept some vega for higher returns, Hedge tail risk (large vol spikes), Use index options (SPX) to hedge portfolio vega cheaply.',
        keyPoints: [
            'Portfolio vega: Sum of (vega × quantity) across all positions; measures P&L sensitivity to IV changes',
            'Vega ≠ volatility risk: Vega is IMPLIED vol exposure, gamma is REALIZED vol exposure; different P&L sources',
            'Term structure: Decompose vega by expiration; front-month and back-month vol can move independently',
            'Hedging: Use opposite strikes, calendar spreads, or VIX futures to neutralize vega while maintaining delta-neutral',
            'Professional focus: Vega is systemic risk (all options move together); large P&L swings require active management',
        ],
    },
];

